<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Product Detail | V Store - Men's Fashion</title>
  <link rel="stylesheet" href="../css/styles.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg-color, #f5f5f5);
      color: var(--text-color, #333);
    }

    .product-detail-page {
      background: var(--bg-color, #ffffff);
      padding: 40px 0;
    }

    .product-detail-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }

    .product-detail-wrapper {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 60px;
      margin-bottom: 60px;
    }

    /* Product Images */
    .product-images {
      display: flex;
      gap: 20px;
    }

    .product-thumbnails {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .thumbnail {
      width: 80px;
      height: 80px;
      object-fit: cover;
      border: 2px solid transparent;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .thumbnail:hover,
    .thumbnail.active {
      border-color: #ff6d2e;
    }

    .main-image-container {
      flex: 1;
      position: relative;
      overflow: hidden;
      border-radius: 12px;
      cursor: zoom-in;
    }

    .main-image {
      width: 100%;
      height: 600px;
      object-fit: cover;
      border-radius: 12px;
      background: var(--card-bg, #fff);
      transition: transform 0.3s ease;
    }
    
    .main-image-container:hover .main-image {
      transform: scale(1.1);
    }
    
    /* Image zoom overlay */
    .image-zoom-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      z-index: 10001;
      cursor: zoom-out;
      align-items: center;
      justify-content: center;
    }
    
    .image-zoom-overlay.active {
      display: flex;
    }
    
    .zoomed-image {
      max-width: 90%;
      max-height: 90%;
      object-fit: contain;
    }

    .wishlist-btn {
      position: absolute;
      top: 16px;
      right: 16px;
      background: rgba(255, 255, 255, 0.9);
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      transition: all 0.3s;
    }

    .wishlist-btn:hover {
      background: #fff;
      transform: scale(1.1);
    }

    .wishlist-btn.active {
      color: #e53935;
    }

    /* Product Details */
    .product-details {
      padding: 20px 0;
    }

    .product-title {
      font-size: 2rem;
      font-weight: 700;
      color: var(--text-color, #333);
      margin-bottom: 16px;
    }

    .product-pricing {
      margin-bottom: 24px;
    }

    .special-offer {
      display: inline-block;
      background: #ff6d2e;
      color: #fff;
      padding: 4px 12px;
      border-radius: 4px;
      font-size: 0.85rem;
      font-weight: 600;
      margin-bottom: 12px;
    }

    .price-row {
      display: flex;
      align-items: baseline;
      gap: 16px;
      margin-bottom: 8px;
    }

    .current-price {
      font-size: 2.5rem;
      font-weight: 700;
      color: #e53935;
    }

    .original-price {
      font-size: 1.5rem;
      color: var(--text-color, #999);
      text-decoration: line-through;
    }

    .discount-badge {
      font-size: 1rem;
      font-weight: 600;
      color: #4caf50;
    }

    /* Color Options */
    .color-section,
    .size-section {
      margin-bottom: 24px;
    }

    .section-label {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-color, #333);
      margin-bottom: 12px;
      display: block;
    }

    .color-options {
      display: flex;
      gap: 12px;
    }

    .color-option {
      width: 60px;
      height: 60px;
      border: 2px solid transparent;
      border-radius: 8px;
      cursor: pointer;
      overflow: hidden;
      transition: all 0.3s;
    }

    .color-option img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .color-option:hover,
    .color-option.active {
      border-color: #ff6d2e;
      transform: scale(1.05);
    }

    /* Size Options */
    .size-options {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
    }

    .size-btn {
      padding: 12px 20px;
      border: 2px solid rgba(0,0,0,0.1);
      background: var(--card-bg, #fff);
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      color: var(--text-color, #333);
      transition: all 0.3s ease;
      min-width: 80px;
      text-align: center;
      position: relative;
    }

    .size-btn:hover {
      border-color: #ff6d2e;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(255, 109, 46, 0.2);
    }

    .size-btn.active {
      border-color: #ff6d2e !important;
      background: #ff6d2e !important;
      color: #fff !important;
      box-shadow: 0 4px 12px rgba(255, 109, 46, 0.3) !important;
    }

    .size-btn.active .size-price {
      color: #fff !important;
      font-weight: 700 !important;
    }
    
    /* Ensure active state overrides hover */
    .size-btn.active:hover {
      border-color: #ff6d2e !important;
      background: #ff6d2e !important;
      color: #fff !important;
    }
    
    /* Make sure all text in active button is white */
    .size-btn.active * {
      color: #fff !important;
    }

    .size-price {
      font-size: 0.9rem;
      color: #e53935;
      font-weight: 600;
      margin-top: 4px;
    }

    .size-chart-link {
      color: #ff6d2e;
      text-decoration: none;
      font-size: 0.9rem;
      margin-left: auto;
      cursor: pointer;
      transition: color 0.2s;
    }

    .size-chart-link:hover {
      color: #e55a1f;
      text-decoration: underline;
    }
    
    /* Quantity Selector - Flipkart Style */
    .quantity-section {
      margin: 24px 0;
    }
    
    .quantity-selector {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-top: 8px;
    }
    
    .quantity-btn {
      width: 36px;
      height: 36px;
      border: 2px solid rgba(0,0,0,0.1);
      background: var(--card-bg, #fff);
      border-radius: 6px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--text-color, #333);
      transition: all 0.2s;
      user-select: none;
    }
    
    .quantity-btn:hover:not(:disabled) {
      border-color: #ff6d2e;
      background: rgba(255, 109, 46, 0.05);
      color: #ff6d2e;
    }
    
    .quantity-btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }
    
    .quantity-input {
      width: 60px;
      height: 36px;
      border: 2px solid rgba(0,0,0,0.1);
      border-radius: 6px;
      text-align: center;
      font-size: 1rem;
      font-weight: 600;
      background: var(--card-bg, #fff);
      color: var(--text-color, #333);
      transition: border-color 0.2s;
    }
    
    .quantity-input:focus {
      outline: none;
      border-color: #ff6d2e;
    }
    
    /* Stock Availability */
    .stock-info {
      display: flex;
      align-items: center;
      gap: 8px;
      margin: 16px 0;
      padding: 12px;
      background: rgba(76, 175, 80, 0.1);
      border-radius: 8px;
      border-left: 4px solid #4caf50;
    }
    
    .stock-info.out-of-stock {
      background: rgba(244, 67, 54, 0.1);
      border-left-color: #f44336;
    }
    
    .stock-indicator {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #4caf50;
    }
    
    .stock-info.out-of-stock .stock-indicator {
      background: #f44336;
    }
    
    .stock-text {
      font-size: 0.95rem;
      font-weight: 600;
      color: #4caf50;
    }
    
    .stock-info.out-of-stock .stock-text {
      color: #f44336;
    }
    
    /* Share Section */
    .share-section {
      margin: 24px 0;
      padding: 16px;
      background: var(--muted-white, #f5f5f5);
      border-radius: 8px;
    }
    
    .share-buttons {
      display: flex;
      gap: 12px;
      margin-top: 12px;
      flex-wrap: wrap;
    }
    
    .share-btn {
      padding: 8px 16px;
      border: 2px solid rgba(0,0,0,0.1);
      background: var(--card-bg, #fff);
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text-color, #333);
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .share-btn:hover {
      border-color: #ff6d2e;
      color: #ff6d2e;
    }
    
    /* Size Chart Modal - Flipkart Style */
    .size-chart-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--overlay-bg, rgba(0, 0, 0, 0.55));
      z-index: 10000;
      align-items: center;
      justify-content: center;
      overflow-y: auto;
      padding: 20px;
    }
    
    .size-chart-modal.active {
      display: flex;
    }
    
    .size-chart-content {
      background: var(--card-bg);
      border-radius: 12px;
      width: 90%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
      position: relative;
      margin: auto;
    }
    
    .size-chart-header {
      padding: 24px;
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      background: var(--card-bg);
      z-index: 1;
    }
    
    body.dark-mode .size-chart-header {
      border-bottom-color: rgba(255, 255, 255, 0.1);
    }
    
    .size-chart-header h3 {
      margin: 0;
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-color);
    }
    
    .size-chart-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--text-color);
      padding: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: all 0.2s;
    }
    
    .size-chart-close:hover {
      background: var(--muted-white);
      color: var(--text-color);
    }
    
    .size-chart-body {
      padding: 24px;
    }
    
    .size-chart-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 16px;
    }
    
    .size-chart-table th {
      background: var(--muted-white);
      padding: 12px;
      text-align: left;
      font-weight: 600;
      color: var(--text-color);
      border-bottom: 2px solid rgba(0, 0, 0, 0.1);
    }
    
    body.dark-mode .size-chart-table th {
      border-bottom-color: rgba(255, 255, 255, 0.1);
    }
    
    .size-chart-table td {
      padding: 12px;
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
      color: var(--text-color);
    }
    
    body.dark-mode .size-chart-table td {
      border-bottom-color: rgba(255, 255, 255, 0.05);
    }
    
    .size-chart-table tr:hover {
      background: rgba(255, 109, 46, 0.05);
    }
    
    body.dark-mode .size-chart-table tr:hover {
      background: rgba(255, 109, 46, 0.1);
    }
    
    .size-chart-size-cell {
      font-weight: 600;
      color: var(--text-color);
      cursor: pointer;
      position: relative;
      padding: 12px 16px !important;
      transition: all 0.2s;
    }
    
    .size-chart-size-cell:hover {
      background: rgba(255, 109, 46, 0.1);
      color: #ff6d2e;
    }
    
    body.dark-mode .size-chart-size-cell:hover {
      background: rgba(255, 109, 46, 0.15);
    }
    
    .size-chart-size-cell.selected {
      background: #ff6d2e !important;
      color: #fff !important;
      font-weight: 700;
    }
    
    .size-chart-size-cell.selected::after {
      content: '✓';
      position: absolute;
      right: 8px;
      font-weight: 700;
      font-size: 1.2rem;
    }
    
    .size-chart-note {
      margin-top: 20px;
      padding: 16px;
      background: var(--muted-white);
      border-radius: 8px;
      font-size: 0.9rem;
      color: var(--text-color);
      line-height: 1.6;
    }

    /* Product Info Sections */
    .info-section {
      margin-bottom: 20px;
      border: 1px solid rgba(0,0,0,0.1);
      border-radius: 8px;
      overflow: hidden;
    }

    .info-header {
      padding: 16px;
      background: var(--muted-white, #f5f5f5);
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: 600;
      color: var(--text-color, #333);
      transition: background 0.3s ease;
      user-select: none;
    }

    .info-header:hover {
      background: rgba(255, 109, 46, 0.1);
    }

    .info-content {
      padding: 16px;
      display: none;
    }

    .info-section.active .info-content {
      display: block;
    }

    .info-item {
      padding: 8px 0;
      border-bottom: 1px solid rgba(0,0,0,0.05);
    }

    .info-item:last-child {
      border-bottom: none;
    }

    .info-label {
      font-weight: 600;
      color: var(--text-color, #666);
    }

    /* Delivery Section */
    .delivery-section {
      margin-bottom: 24px;
      padding: 16px;
      background: var(--muted-white, #f5f5f5);
      border-radius: 8px;
    }

    .delivery-input-group {
      display: flex;
      gap: 8px;
      margin-top: 8px;
    }

    .delivery-input {
      flex: 1;
      padding: 10px 16px;
      border: 2px solid rgba(0,0,0,0.1);
      border-radius: 6px;
      font-size: 0.95rem;
      transition: border-color 0.3s ease;
      background: var(--card-bg, #fff);
      color: var(--text-color, #333);
    }

    .delivery-input:focus {
      outline: none;
      border-color: #ff6d2e;
      box-shadow: 0 0 0 3px rgba(255, 109, 46, 0.1);
    }

    .check-delivery-btn {
      padding: 10px 20px;
      background: #ff6d2e;
      color: #fff;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s;
    }

    .check-delivery-btn:hover {
      background: #e55a1f;
    }

    /* Action Buttons */
    .action-buttons {
      display: flex;
      gap: 16px;
      margin-top: 32px;
    }

    .btn-add-cart,
    .btn-buy-now {
      flex: 1;
      padding: 16px 24px;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: all 0.3s;
    }

    .btn-add-cart {
      background: #fff;
      color: var(--text-color, #333);
      border: 2px solid rgba(0,0,0,0.1);
    }

    .btn-add-cart:hover {
      border-color: #ff6d2e;
      color: #ff6d2e;
    }

    .btn-buy-now {
      background: #ff6d2e;
      color: #fff;
    }

    .btn-buy-now:hover {
      background: #e55a1f;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(255, 109, 46, 0.3);
    }

    /* Related Products */
    .related-section {
      margin-top: 60px;
    }

    .section-heading {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-color, #333);
      margin-bottom: 24px;
    }

    .related-carousel {
      display: flex;
      gap: 20px;
      overflow-x: auto;
      padding-bottom: 20px;
      scroll-behavior: smooth;
      scroll-snap-type: x mandatory;
    }
    
    .related-product-card {
      scroll-snap-align: start;
    }

    .related-carousel::-webkit-scrollbar {
      height: 6px;
    }

    .related-carousel::-webkit-scrollbar-track {
      background: var(--muted-white, #f5f5f5);
      border-radius: 3px;
    }

    .related-carousel::-webkit-scrollbar-thumb {
      background: #ff6d2e;
      border-radius: 3px;
    }

    .related-product-card {
      min-width: 200px;
      background: var(--card-bg, #fff);
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      transition: transform 0.3s;
    }

    .related-product-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 4px 16px rgba(0,0,0,0.15);
    }

    .related-product-card img {
      width: 100%;
      height: 200px;
      object-fit: cover;
    }

    .related-product-info {
      padding: 16px;
    }

    .related-product-name {
      font-size: 0.9rem;
      color: var(--text-color, #333);
      margin-bottom: 8px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .related-product-price {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .related-discount {
      background: #4caf50;
      color: #fff;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .related-original-price {
      font-size: 0.85rem;
      color: var(--text-color, #999);
      text-decoration: line-through;
    }

    .related-current-price {
      font-size: 1rem;
      font-weight: 700;
      color: #e53935;
    }

    @media (max-width: 968px) {
      .product-detail-wrapper {
        grid-template-columns: 1fr;
        gap: 40px;
      }

      .product-images {
        flex-direction: column;
      }

      .product-thumbnails {
        flex-direction: row;
        overflow-x: auto;
      }

      .main-image {
        height: 400px;
      }

      .action-buttons {
        flex-direction: column;
      }
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @keyframes pulse {
      0%, 100% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.05);
      }
    }

    @media (max-width: 768px) {
      .product-detail-page {
        padding: 20px 0;
      }

      .product-title {
        font-size: 1.5rem;
      }

      .current-price {
        font-size: 2rem;
      }

      .size-options {
        flex-direction: column;
        align-items: stretch;
      }

      .size-btn {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="page-wrapper">
    <header class="topbar">
      <div class="topbar-inner container">
        <div class="left-group">
          <div class="avatar" aria-hidden="true">
            <a href="../index.html" style="text-decoration:none;color:inherit;display:flex;align-items:center;justify-content:center;width:100%;height:100%;"><span>V</span></a>
          </div>
          <div class="divider"></div>
          <nav class="main-nav" aria-label="Main">
            <a href="categories.html" class="nav-item">Categories</a>
            <a href="featured.html" class="nav-item">Featured</a>
            <a href="products.html" class="nav-item">Products</a>
          </nav>
          <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Toggle Menu">☰</button>
        </div>
        <div class="right-group">
          <!-- Dark Mode Toggle Switch -->
          <div class="dark-mode-toggle-container">
            <label class="dark-mode-toggle" for="dark-mode-switch" title="Toggle Dark Mode">
              <input type="checkbox" id="dark-mode-switch" class="toggle-input">
              <span class="toggle-track">
                <svg class="sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="4"></circle>
                  <line x1="12" y1="1" x2="12" y2="3"></line>
                  <line x1="12" y1="21" x2="12" y2="23"></line>
                  <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                  <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                  <line x1="1" y1="12" x2="3" y2="12"></line>
                  <line x1="21" y1="12" x2="23" y2="12"></line>
                  <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                  <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                </svg>
                <svg class="moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                </svg>
                <span class="toggle-indicator"></span>
              </span>
            </label>
          </div>

          <button class="icon-btn" id="searchBtn" title="Search Products">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor">
              <circle cx="11" cy="11" r="6" stroke-width="1.6"></circle>
              <path d="M21 21l-4.35-4.35" stroke-width="1.6" stroke-linecap="round"></path>
            </svg>
          </button>

          <button class="icon-btn" id="wishlistBtn" title="Wishlist" onclick="window.location.href='wishlist.html'">
            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor">
              <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" stroke-width="1.5" stroke-linejoin="round"></path>
            </svg>
            <span class="wishlist-count" id="wishlistCount">0</span>
          </button>
          <button class="icon-btn" id="cartBtn" title="Cart" onclick="window.location.href='cart.html'">
            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor">
              <path d="M6 6h15l-1.5 9h-12z" stroke-width="1.5" stroke-linejoin="round"></path>
              <circle cx="10" cy="20" r="1.4" stroke-width="1.5"></circle>
              <circle cx="18" cy="20" r="1.4" stroke-width="1.5"></circle>
            </svg>
            <span class="cart-count" id="cartCount">0</span>
          </button>

          <!-- Login Dropdown -->
          <div class="login-dropdown-container">
            <button class="icon-btn login-dropdown-btn" id="loginDropdownBtn" title="User Menu">
              <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
              </svg>
            </button>
            <div class="login-dropdown" id="loginDropdown">
              <div class="dropdown-header">
                <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                  <path d="M2 17l10 5 10-5"></path>
                  <path d="M2 12l10 5 10-5"></path>
                </svg>
                <span>User...</span>
              </div>
              <div class="dropdown-profile">
                <div class="profile-avatar">
                  <svg viewBox="0 0 24 24" width="48" height="48" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                  </svg>
                </div>
                <div class="profile-info">
                  <div class="profile-name">Hello User</div>
                  <div class="profile-phone">+1234567890</div>
                </div>
              </div>
              <div class="dropdown-divider"></div>
              <div class="dropdown-menu">
                <a href="orders.html" class="dropdown-item" id="myOrdersBtn">
                  <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5">
                    <circle cx="9" cy="21" r="1"></circle>
                    <circle cx="20" cy="21" r="1"></circle>
                    <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                  </svg>
                  <span>My Orders</span>
                  <svg viewBox="0 0 24 24" width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" class="item-indicator">
                    <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                    <path d="M2 17l10 5 10-5"></path>
                    <path d="M2 12l10 5 10-5"></path>
                  </svg>
                </a>
                <div class="dropdown-item" id="lightModeBtn">
                  <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5">
                    <rect x="1" y="5" width="22" height="14" rx="7" ry="7"></rect>
                    <circle cx="8" cy="12" r="3"></circle>
                  </svg>
                  <span id="lightModeText">Light Mode</span>
                  <svg viewBox="0 0 24 24" width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" class="item-indicator">
                    <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                    <path d="M2 17l10 5 10-5"></path>
                    <path d="M2 12l10 5 10-5"></path>
                  </svg>
                </div>
                <a href="login.html" class="dropdown-item" id="signOutBtn">
                  <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                    <polyline points="16 17 21 12 16 7"></polyline>
                    <line x1="21" y1="12" x2="9" y2="12"></line>
                  </svg>
                  <span>Sign Out</span>
                  <svg viewBox="0 0 24 24" width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" class="item-indicator">
                    <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
                    <path d="M2 17l10 5 10-5"></path>
                    <path d="M2 12l10 5 10-5"></path>
                  </svg>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Mobile Navigation -->
    <nav class="mobile-nav" id="mobileNav">
      <a href="categories.html" class="nav-item">Categories</a>
      <a href="featured.html" class="nav-item">Featured</a>
      <a href="products.html" class="nav-item">Products</a>
      <a href="cart.html" class="nav-item">Cart</a>
      <a href="login.html" class="nav-item">Login</a>
    </nav>

    <!-- Size Chart Modal -->
    <div class="size-chart-modal" id="sizeChartModal">
      <div class="size-chart-content">
        <div class="size-chart-header">
          <h3>Size Chart</h3>
          <button class="size-chart-close" id="sizeChartClose" aria-label="Close size chart">×</button>
        </div>
        <div class="size-chart-body">
          <p style="margin: 0 0 16px 0; color: var(--text-color);">Click on a size to select it</p>
          <table class="size-chart-table">
            <thead>
              <tr>
                <th>Size</th>
                <th>Chest (inches)</th>
                <th>Length (inches)</th>
                <th>Shoulder (inches)</th>
                <th>Sleeve (inches)</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="size-chart-size-cell" data-size="S" data-price="456">S</td>
                <td>36-38</td>
                <td>27</td>
                <td>16</td>
                <td>8</td>
              </tr>
              <tr>
                <td class="size-chart-size-cell" data-size="M" data-price="466">M</td>
                <td>38-40</td>
                <td>28</td>
                <td>17</td>
                <td>8.5</td>
              </tr>
              <tr>
                <td class="size-chart-size-cell" data-size="L" data-price="476">L</td>
                <td>40-42</td>
                <td>29</td>
                <td>18</td>
                <td>9</td>
              </tr>
              <tr>
                <td class="size-chart-size-cell" data-size="XL" data-price="486">XL</td>
                <td>42-44</td>
                <td>30</td>
                <td>19</td>
                <td>9.5</td>
              </tr>
              <tr>
                <td class="size-chart-size-cell" data-size="XXL" data-price="496">XXL</td>
                <td>44-46</td>
                <td>31</td>
                <td>20</td>
                <td>10</td>
              </tr>
            </tbody>
          </table>
          <div class="size-chart-note">
            <strong>Note:</strong> Measurements are approximate and may vary slightly. Please refer to the product description for specific measurements. If you're between sizes, we recommend sizing up.
          </div>
        </div>
      </div>
    </div>

    <!-- Image Zoom Overlay -->
    <div class="image-zoom-overlay" id="imageZoomOverlay" onclick="closeImageZoom()">
      <img class="zoomed-image" id="zoomedImage" src="" alt="Zoomed Product Image">
    </div>

    <!-- Search Modal -->
    <div class="search-modal" id="searchModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
      <div class="search-modal-content" style="background: var(--card-bg, #fff); padding: 30px; border-radius: 12px; width: 90%; max-width: 500px; box-shadow: 0 8px 24px rgba(0,0,0,0.2); position: relative;">
        <h3 style="margin-bottom: 20px; color: var(--text-color, #333); font-size: 1.5rem;">Search Products</h3>
        <div style="position: relative; margin-bottom: 20px;">
          <input type="text" class="search-input" id="searchInput" placeholder="Search for products..." autocomplete="off" style="width: 100%; padding: 12px 40px 12px 16px; border: 2px solid rgba(0,0,0,0.1); border-radius: 8px; font-size: 1rem; background: var(--bg-color, #fff); color: var(--text-color, #333); transition: border-color 0.3s;">
          <button class="search-close" id="searchClose" style="position: absolute; top: 50%; right: 12px; transform: translateY(-50%); background: none; border: none; font-size: 24px; cursor: pointer; color: var(--text-color, #666); padding: 0; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center;">&times;</button>
        </div>
        <div class="search-results" id="searchResults" style="max-height: 400px; overflow-y: auto;">
          <!-- Search results will appear here -->
        </div>
      </div>
    </div>

    <main class="product-detail-page">
      <div class="product-detail-container">
        <!-- Breadcrumb -->
        <nav class="breadcrumb" aria-label="Breadcrumb">
          <ol class="breadcrumb-list">
            <li class="breadcrumb-item">
              <a href="../index.html" class="breadcrumb-link">Home</a>
            </li>
            <li class="breadcrumb-item">
              <span class="breadcrumb-separator">›</span>
            </li>
            <li class="breadcrumb-item">
              <a href="products.html" class="breadcrumb-link">Products</a>
            </li>
            <li class="breadcrumb-item">
              <span class="breadcrumb-separator">›</span>
            </li>
            <li class="breadcrumb-item">
              <span class="breadcrumb-link active" id="breadcrumbProductName">Product</span>
            </li>
          </ol>
        </nav>

        <div class="product-detail-wrapper">
          <!-- Product Images -->
          <div class="product-images">
            <div class="product-thumbnails">
              <img src="../assets/products/p1.jpg" alt="Product Thumbnail 1" class="thumbnail active" onclick="changeMainImage(this.src); this.classList.add('active'); document.querySelectorAll('.thumbnail').forEach(t => { if(t !== this) t.classList.remove('active'); });">
              <img src="../assets/products/p2.jpg" alt="Product Thumbnail 2" class="thumbnail" onclick="changeMainImage(this.src); this.classList.add('active'); document.querySelectorAll('.thumbnail').forEach(t => { if(t !== this) t.classList.remove('active'); });">
              <img src="../assets/products/p3.jpg" alt="Product Thumbnail 3" class="thumbnail" onclick="changeMainImage(this.src); this.classList.add('active'); document.querySelectorAll('.thumbnail').forEach(t => { if(t !== this) t.classList.remove('active'); });">
            </div>
            <div class="main-image-container" onclick="openImageZoom(document.getElementById('mainProductImage').src)">
              <img src="../assets/products/p1.jpg" alt="Product Main Image" class="main-image" id="mainProductImage">
              <!-- Product Badge -->
              <div class="product-badge sale" id="productBadge" style="display: none;">Sale</div>
              <button class="wishlist-btn" id="productWishlistBtn" title="Add to Wishlist" onclick="event.stopPropagation();">
                <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                </svg>
              </button>
            </div>
          </div>

          <!-- Product Details -->
          <div class="product-details">
            <h1 class="product-title" id="productTitle">Men's Pure Cotton T-Shirt</h1>
            
            <div class="product-pricing">
              <span class="special-offer">Special Offer</span>
              <div class="price-row">
                <span class="current-price" id="currentPrice">₹476</span>
                <span class="original-price" id="originalPrice">₹1,499</span>
                <span class="discount-badge" id="discountBadge">68% OFF</span>
              </div>
            </div>

            <!-- Stock Availability -->
            <div class="stock-availability" id="stockAvailability" style="margin-bottom: 16px;">
              <div class="stock-indicator in-stock">
                <span class="stock-indicator-icon"></span>
                <span>In Stock</span>
              </div>
            </div>

            <!-- Color Options -->
            <div class="color-section">
              <label class="section-label">Color</label>
              <div class="color-swatches" id="colorSwatches">
                <div class="color-swatch active" data-color="Blue" onclick="selectColorSwatch(this, '../assets/products/p1.jpg')">
                  <img src="../assets/products/p1.jpg" alt="Blue">
                  <span class="color-swatch-name">Blue</span>
                </div>
                <div class="color-swatch" data-color="Black" onclick="selectColorSwatch(this, '../assets/products/p2.jpg')">
                  <img src="../assets/products/p2.jpg" alt="Black">
                  <span class="color-swatch-name">Black</span>
                </div>
                <div class="color-swatch" data-color="White" onclick="selectColorSwatch(this, '../assets/products/p3.jpg')">
                  <img src="../assets/products/p3.jpg" alt="White">
                  <span class="color-swatch-name">White</span>
                </div>
                <div class="color-swatch" data-color="Grey" onclick="selectColorSwatch(this, '../assets/products/p4.jpg')">
                  <img src="../assets/products/p4.jpg" alt="Grey">
                  <span class="color-swatch-name">Grey</span>
                </div>
              </div>
            </div>

            <!-- Quantity Selector -->
            <div class="quantity-section">
              <label class="section-label">Quantity</label>
              <div class="quantity-selector">
                <button class="quantity-btn" id="decreaseQty" onclick="changeQuantity(-1)">−</button>
                <input type="number" class="quantity-input" id="quantityInput" value="1" min="1" max="10" onchange="updateQuantity(this.value)">
                <button class="quantity-btn" id="increaseQty" onclick="changeQuantity(1)">+</button>
              </div>
            </div>

            <!-- Size Options -->
            <div class="size-section">
              <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
                <label class="section-label">Size</label>
                <a href="#" class="size-chart-link" id="sizeChartLink" onclick="event.preventDefault(); openSizeGuide();">Size Chart</a>
              </div>
              <div class="size-options" id="sizeOptions">
                <div class="size-btn" data-price="456" data-size="S" onclick="selectSize(this, 456)" role="button" tabindex="0" aria-label="Select Size S - ₹456" aria-pressed="false">
                  <div>S</div>
                  <div class="size-price">₹456</div>
                </div>
                <div class="size-btn" data-price="466" data-size="M" onclick="selectSize(this, 466)" role="button" tabindex="0" aria-label="Select Size M - ₹466" aria-pressed="false">
                  <div>M</div>
                  <div class="size-price">₹466</div>
                </div>
                <div class="size-btn active" data-price="476" data-size="L" onclick="selectSize(this, 476)" role="button" tabindex="0" aria-label="Select Size L - ₹476" aria-pressed="true">
                  <div>L</div>
                  <div class="size-price">₹476</div>
                </div>
                <div class="size-btn" data-price="486" data-size="XL" onclick="selectSize(this, 486)" role="button" tabindex="0" aria-label="Select Size XL - ₹486" aria-pressed="false">
                  <div>XL</div>
                  <div class="size-price">₹486</div>
                </div>
                <div class="size-btn" data-price="496" data-size="XXL" onclick="selectSize(this, 496)" role="button" tabindex="0" aria-label="Select Size XXL - ₹496" aria-pressed="false">
                  <div>XXL</div>
                  <div class="size-price">₹496</div>
                </div>
              </div>
            </div>

            <!-- Product Highlights -->
            <div class="info-section" id="highlightsSection">
              <div class="info-header" onclick="toggleSection('highlightsSection')">
                <span>Product Highlights</span>
                <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" style="transition: transform 0.3s;">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </div>
              <div class="info-content">
                <div class="info-item">
                  <span class="info-label">Fabric:</span> Pure Cotton
                </div>
                <div class="info-item">
                  <span class="info-label">Pattern:</span> Printed
                </div>
                <div class="info-item">
                  <span class="info-label">Fit:</span> Regular Fit
                </div>
                <div class="info-item">
                  <span class="info-label">Care:</span> Machine Wash
                </div>
              </div>
            </div>

            <!-- Additional Details -->
            <div class="info-section" id="detailsSection">
              <div class="info-header" onclick="toggleSection('detailsSection')">
                <span>Additional Details</span>
                <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" style="transition: transform 0.3s;">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </div>
              <div class="info-content">
                <div class="info-item">
                  <span class="info-label">Neck:</span> Round Neck
                </div>
                <div class="info-item">
                  <span class="info-label">Sleeve:</span> Half Sleeve
                </div>
                <div class="info-item">
                  <span class="info-label">Print Type:</span> Geometric
                </div>
                <div class="info-item">
                  <span class="info-label">Material:</span> 100% Cotton
                </div>
              </div>
            </div>

            <!-- Delivery Section -->
            <div class="delivery-section">
              <label class="section-label">Delivery To</label>
              <div class="delivery-input-group">
                <input type="text" class="delivery-input" id="pincodeInput" placeholder="Enter Pincode to check" maxlength="6" autocomplete="off" inputmode="numeric">
                <button type="button" class="check-delivery-btn" id="checkDeliveryBtn" onclick="checkDelivery()">Check</button>
              </div>
              <div id="deliveryMessage" style="margin-top: 8px; font-size: 0.9rem; color: var(--text-color, #666);"></div>
            </div>

            <!-- Action Buttons -->
            <!-- Social Sharing -->
          <div class="social-sharing" style="margin-bottom: 24px; padding: 16px; background: var(--muted-white, #f5f5f5); border-radius: 12px;">
            <div style="font-size: 0.9rem; font-weight: 600; margin-bottom: 12px; color: var(--text-color, #333);">Share this product:</div>
            <div class="social-share-buttons" style="display: flex; gap: 12px; flex-wrap: wrap;">
              <button class="social-share-btn" data-platform="whatsapp" onclick="shareProduct('whatsapp')" style="display: flex; align-items: center; gap: 8px; padding: 8px 16px; background: #25D366; color: #fff; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 0.9rem; transition: transform 0.2s;">
                <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                  <path d="M17.472 14.382c-.297-.149-1.758-1.149-2.03-1.285-.272-.136-.47-.149-.669.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
                </svg>
                WhatsApp
              </button>
              <button class="social-share-btn" data-platform="facebook" onclick="shareProduct('facebook')" style="display: flex; align-items: center; gap: 8px; padding: 8px 16px; background: #1877F2; color: #fff; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 0.9rem; transition: transform 0.2s;">
                <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                  <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                </svg>
                Facebook
              </button>
              <button class="social-share-btn" data-platform="twitter" onclick="shareProduct('twitter')" style="display: flex; align-items: center; gap: 8px; padding: 8px 16px; background: #1DA1F2; color: #fff; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 0.9rem; transition: transform 0.2s;">
                <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                  <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
                </svg>
                Twitter
              </button>
              <button class="social-share-btn" data-platform="copy" onclick="shareProduct('copy')" style="display: flex; align-items: center; gap: 8px; padding: 8px 16px; background: var(--card-bg, #fff); color: var(--text-color, #333); border: 2px solid rgba(0,0,0,0.1); border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 0.9rem; transition: transform 0.2s;">
                <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                  <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                </svg>
                Copy Link
              </button>
            </div>
          </div>

          <div class="action-buttons">
              <button type="button" class="btn-add-cart" id="addToCartBtn" onclick="addToCart()">
                <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M6 6h15l-1.5 9h-12z"></path>
                  <circle cx="10" cy="20" r="1.4"></circle>
                  <circle cx="18" cy="20" r="1.4"></circle>
                </svg>
                Add to cart
              </button>
              <button type="button" class="btn-buy-now" id="buyNowBtn" onclick="buyNow()">
                Buy Now
                <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="9 18 15 12 9 6"></polyline>
                </svg>
              </button>
            </div>
            
            <!-- Price Drop Alert -->
            <button class="price-alert-btn" id="priceAlertBtn" onclick="openPriceAlert()">
              <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
              </svg>
              Notify me when price drops
            </button>
          </div>
        </div>

        <!-- Bundle Deals Section -->
        <div class="bundle-section" id="bundleSection" style="display: none;">
          <h3 class="bundle-title">Frequently Bought Together</h3>
          <div class="bundle-items" id="bundleItems"></div>
          <div class="bundle-savings" id="bundleSavings"></div>
          <button class="bundle-add-all" onclick="addBundleToCart()">Add All to Cart - Save ₹<span id="bundleSaveAmount">0</span></button>
        </div>

        <!-- Product Video Section -->
        <div class="product-video-section" id="productVideoSection" style="display: none;">
          <h3 style="margin-bottom: 16px; color: var(--text-color, #333); font-size: 1.2rem; font-weight: 600;">Product Video</h3>
          <div class="product-video-container" id="productVideoContainer"></div>
        </div>

        <!-- Product Q&A Section -->
        <div class="qa-section" id="qaSection">
          <h3 style="margin-bottom: 20px; color: var(--text-color, #333); font-size: 1.2rem; font-weight: 600;">Questions & Answers</h3>
          <div id="qaList">
            <div class="qa-item">
              <div class="qa-question" onclick="toggleQA(this)">
                <span>What is the material of this product?</span>
                <svg class="qa-icon" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </div>
              <div class="qa-answer">This product is made from 100% pure cotton, ensuring comfort and durability.</div>
            </div>
            <div class="qa-item">
              <div class="qa-question" onclick="toggleQA(this)">
                <span>What sizes are available?</span>
                <svg class="qa-icon" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </div>
              <div class="qa-answer">We have sizes S, M, L, XL, and XXL available. Please refer to our size chart for accurate measurements.</div>
            </div>
            <div class="qa-item">
              <div class="qa-question" onclick="toggleQA(this)">
                <span>What is the return policy?</span>
                <svg class="qa-icon" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </div>
              <div class="qa-answer">We offer a 7-day return policy. Items must be unused and in original packaging with tags attached.</div>
            </div>
          </div>
          <div class="ask-question-form">
            <h4 style="margin-bottom: 12px; color: var(--text-color, #333);">Ask a Question</h4>
            <textarea id="questionInput" placeholder="Type your question here..." style="width: 100%; padding: 12px; border: 2px solid rgba(0,0,0,0.1); border-radius: 8px; min-height: 80px; margin-bottom: 12px; background: var(--bg-color, #fff); color: var(--text-color, #333); resize: vertical;"></textarea>
            <button onclick="submitQuestion()" style="padding: 10px 20px; background: #ff6d2e; color: #fff; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">Submit Question</button>
          </div>
        </div>

        <!-- Product Recommendations -->
        <div class="recommendations-section" id="recommendationsSection">
          <h2 class="recommendations-title">You May Also Like</h2>
          <div class="recommendations-grid" id="recommendationsGrid"></div>
        </div>

        <!-- You might also like -->
        <div class="related-section">
          <h2 class="section-heading">You might also like</h2>
          <div class="related-carousel" id="youMightLikeCarousel">
            <div class="related-product-card" onclick="window.location.href='product-detail.html?name=Men%27s%20Casual%20T-Shirt&price=471&originalPrice=1099&image=../assets/products/p2.jpg&brand=V%20Store'">
              <img src="../assets/products/p2.jpg" alt="Related Product">
              <div class="related-product-info">
                <div class="related-product-name">Men's Casual T-Shirt</div>
                <div class="related-product-price">
                  <span class="related-discount">57% OFF</span>
                  <span class="related-original-price">₹1,099</span>
                  <span class="related-current-price">₹471</span>
                </div>
              </div>
            </div>
            <div class="related-product-card" onclick="window.location.href='product-detail.html?name=Men%27s%20Formal%20Shirt&price=699&originalPrice=1299&image=../assets/products/p3.jpg&brand=V%20Store'">
              <img src="../assets/products/p3.jpg" alt="Related Product">
              <div class="related-product-info">
                <div class="related-product-name">Men's Formal Shirt</div>
                <div class="related-product-price">
                  <span class="related-discount">46% OFF</span>
                  <span class="related-original-price">₹1,299</span>
                  <span class="related-current-price">₹699</span>
                </div>
              </div>
            </div>
            <div class="related-product-card" onclick="window.location.href='product-detail.html?name=Men%27s%20Polo%20T-Shirt&price=479&originalPrice=999&image=../assets/products/p4.jpg&brand=V%20Store'">
              <img src="../assets/products/p4.jpg" alt="Related Product">
              <div class="related-product-info">
                <div class="related-product-name">Men's Polo T-Shirt</div>
                <div class="related-product-price">
                  <span class="related-discount">52% OFF</span>
                  <span class="related-original-price">₹999</span>
                  <span class="related-current-price">₹479</span>
                </div>
              </div>
            </div>
            <div class="related-product-card" onclick="window.location.href='product-detail.html?name=Men%27s%20Cotton%20Shirt&price=619&originalPrice=1199&image=../assets/products/p5.jpg&brand=V%20Store'">
              <img src="../assets/products/p5.jpg" alt="Related Product">
              <div class="related-product-info">
                <div class="related-product-name">Men's Cotton Shirt</div>
                <div class="related-product-price">
                  <span class="related-discount">48% OFF</span>
                  <span class="related-original-price">₹1,199</span>
                  <span class="related-current-price">₹619</span>
                </div>
              </div>
            </div>
            <div class="related-product-card" onclick="window.location.href='product-detail.html?name=Men%27s%20Printed%20T-Shirt&price=404&originalPrice=899&image=../assets/products/p6.jpg&brand=V%20Store'">
              <img src="../assets/products/p6.jpg" alt="Related Product">
              <div class="related-product-info">
                <div class="related-product-name">Men's Printed T-Shirt</div>
                <div class="related-product-price">
                  <span class="related-discount">55% OFF</span>
                  <span class="related-original-price">₹899</span>
                  <span class="related-current-price">₹404</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Recently Viewed -->
        <div class="related-section">
          <h2 class="section-heading">Recently Viewed</h2>
          <div class="related-carousel" id="recentlyViewedCarousel">
            <div class="related-product-card" onclick="window.location.href='product-detail.html?name=Men%27s%20Casual%20T-Shirt&price=471&originalPrice=1099&image=../assets/products/p2.jpg&brand=V%20Store'">
              <img src="../assets/products/p2.jpg" alt="Related Product">
              <div class="related-product-info">
                <div class="related-product-name">Men's Casual T-Shirt</div>
                <div class="related-product-price">
                  <span class="related-discount">57% OFF</span>
                  <span class="related-original-price">₹1,099</span>
                  <span class="related-current-price">₹471</span>
                </div>
              </div>
            </div>
            <div class="related-product-card" onclick="window.location.href='product-detail.html?name=Men%27s%20Formal%20Shirt&price=699&originalPrice=1299&image=../assets/products/p3.jpg&brand=V%20Store'">
              <img src="../assets/products/p3.jpg" alt="Related Product">
              <div class="related-product-info">
                <div class="related-product-name">Men's Formal Shirt</div>
                <div class="related-product-price">
                  <span class="related-discount">46% OFF</span>
                  <span class="related-original-price">₹1,299</span>
                  <span class="related-current-price">₹699</span>
                </div>
              </div>
            </div>
            <div class="related-product-card" onclick="window.location.href='product-detail.html?name=Men%27s%20Polo%20T-Shirt&price=479&originalPrice=999&image=../assets/products/p4.jpg&brand=V%20Store'">
              <img src="../assets/products/p4.jpg" alt="Related Product">
              <div class="related-product-info">
                <div class="related-product-name">Men's Polo T-Shirt</div>
                <div class="related-product-price">
                  <span class="related-discount">52% OFF</span>
                  <span class="related-original-price">₹999</span>
                  <span class="related-current-price">₹479</span>
                </div>
              </div>
            </div>
            <div class="related-product-card" onclick="window.location.href='product-detail.html?name=Men%27s%20Cotton%20Shirt&price=619&originalPrice=1199&image=../assets/products/p5.jpg&brand=V%20Store'">
              <img src="../assets/products/p5.jpg" alt="Related Product">
              <div class="related-product-info">
                <div class="related-product-name">Men's Cotton Shirt</div>
                <div class="related-product-price">
                  <span class="related-discount">48% OFF</span>
                  <span class="related-original-price">₹1,199</span>
                  <span class="related-current-price">₹619</span>
                </div>
              </div>
            </div>
            <div class="related-product-card" onclick="window.location.href='product-detail.html?name=Men%27s%20Printed%20T-Shirt&price=404&originalPrice=899&image=../assets/products/p6.jpg&brand=V%20Store'">
              <img src="../assets/products/p6.jpg" alt="Related Product">
              <div class="related-product-info">
                <div class="related-product-name">Men's Printed T-Shirt</div>
                <div class="related-product-price">
                  <span class="related-discount">55% OFF</span>
                  <span class="related-original-price">₹899</span>
                  <span class="related-current-price">₹404</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Reviews Section -->
        <div class="reviews-section" id="reviewsSection">
          <div class="reviews-header">
            <div>
              <h2 class="reviews-title">Customer Reviews</h2>
              <div class="reviews-stats" id="reviewsStats">
                <div class="average-rating">
                  <span class="rating-number" id="averageRating">0</span>
                  <div class="rating-stars" id="averageStars"></div>
                </div>
                <span class="reviews-count" id="reviewsCount">(0 reviews)</span>
              </div>
            </div>
            <button class="write-review-btn" id="writeReviewBtn" type="button" onclick="openReviewForm()">Write a Review</button>
          </div>

          <!-- Review Form -->
          <div class="review-form" id="reviewForm">
            <h3 class="review-form-title">Write Your Review</h3>
            <form id="reviewFormElement">
              <div class="rating-input">
                <label>Your Rating <span style="color: #e53935;">*</span></label>
                <div style="display: flex; align-items: center; gap: 12px; flex-wrap: wrap;">
                  <div class="star-rating-input" id="starRatingInput">
                    <input type="radio" id="star5" name="rating" value="5" required>
                    <label for="star5" title="Excellent">★</label>
                    <input type="radio" id="star4" name="rating" value="4">
                    <label for="star4" title="Very Good">★</label>
                    <input type="radio" id="star3" name="rating" value="3">
                    <label for="star3" title="Good">★</label>
                    <input type="radio" id="star2" name="rating" value="2">
                    <label for="star2" title="Fair">★</label>
                    <input type="radio" id="star1" name="rating" value="1">
                    <label for="star1" title="Poor">★</label>
                  </div>
                  <span class="rating-display" id="ratingDisplay">Select a rating</span>
                </div>
              </div>
              <div style="margin-top: 20px;">
                <label for="reviewerName">Your Name <span style="color: #e53935;">*</span></label>
                <input type="text" id="reviewerName" placeholder="Enter your name" required>
              </div>
              <div style="margin-top: 20px;">
                <label for="reviewText">Your Review <span style="color: #e53935;">*</span></label>
                <textarea id="reviewText" placeholder="Share your experience with this product... (minimum 10 characters)" required minlength="10"></textarea>
                <div style="font-size: 0.85rem; color: var(--text-color, #666); margin-top: 4px; text-align: right;">
                  <span id="charCount">0</span> / 500 characters
                </div>
              </div>
              <div class="review-form-actions">
                <button type="submit" class="submit-review-btn">Submit Review</button>
                <button type="button" class="cancel-review-btn" id="cancelReviewBtn">Cancel</button>
              </div>
            </form>
          </div>

          <!-- Reviews List -->
          <div class="reviews-list" id="reviewsList">
            <div class="no-reviews">
              <div class="no-reviews-icon">💬</div>
              <p>No reviews yet. Be the first to review this product!</p>
            </div>
          </div>
        </div>

        <!-- Recently Viewed Products -->
        <div class="recently-viewed-section" id="recentlyViewedSection" style="display: none;">
          <h2 class="recently-viewed-title">Recently Viewed</h2>
          <div class="recently-viewed-grid" id="recentlyViewedGrid">
            <!-- Recently viewed products will be inserted here -->
          </div>
        </div>
      </div>
    </main>
  
  <!-- Footer Component (loaded from components/footer.html) -->
  <div id="footer-placeholder" style="width: 100%; margin-top: auto; flex-shrink: 0;"></div>
  </div>
  
  <!-- Load components first, then app.js -->
  <script src="../js/load-components.js"></script>
  <script src="../js/app.js"></script>
  <script>
    // Global product data variable
    let currentProductData = null;

    // Get product data from URL parameters (fallback for old links)
    function getProductFromURL() {
      if (currentProductData) {
        return currentProductData;
      }
      
      const params = new URLSearchParams(window.location.search);
      const productData = {
        productId: params.get('productId') || params.get('id'),
        name: params.get('name') || "Men's Pure Cotton T-Shirt",
        price: parseInt(params.get('price')) || 476,
        originalPrice: parseInt(params.get('originalPrice')) || 1499,
        image: params.get('image') || '../assets/products/p1.jpg',
        brand: params.get('brand') || 'V Store'
      };
      return productData;
    }

    // Load product data from backend API
    async function loadProductFromAPI(productId) {
      if (!productId || !window.API) {
        console.warn('ProductId or API not available, using URL parameters');
        return null;
      }

      try {
        console.log('Fetching product data for productId:', productId);
        const product = await window.API.getProductById(productId);
        
        if (product) {
          // Map backend product data to frontend format
          currentProductData = {
            productId: product.productId || product.id,
            name: product.productName || product.name,
            price: product.sellingPrice || product.price,
            originalPrice: product.mrp || product.originalPrice || product.sellingPrice,
            image: product.imageUrl || product.image || '../assets/products/p1.jpg',
            brand: product.brand || 'V Store',
            description: product.description || product.productDescription || '',
            category: product.productCategory || product.category,
            stock: product.stock || product.quantity || 0,
            sellerId: product.sellerId
          };
          
          console.log('Product data loaded from API:', currentProductData);
          return currentProductData;
        }
      } catch (error) {
        console.error('Error loading product from API:', error);
        return null;
      }
    }

    // Update page with product data
    async function loadProductData() {
      const params = new URLSearchParams(window.location.search);
      const productId = params.get('productId') || params.get('id');
      
      // Try to load from API first if productId is available
      if (productId) {
        const apiProduct = await loadProductFromAPI(productId);
        if (apiProduct) {
          currentProductData = apiProduct;
        }
      }
      
      // Get product data (from API or URL parameters)
      const product = getProductFromURL();
      
      // Update page elements
      if (document.getElementById('productTitle')) {
        document.getElementById('productTitle').textContent = product.name;
      }
      
      if (document.getElementById('currentPrice')) {
        document.getElementById('currentPrice').textContent = '₹' + product.price.toLocaleString();
      }
      
      if (document.getElementById('originalPrice')) {
        document.getElementById('originalPrice').textContent = '₹' + (product.originalPrice || product.price).toLocaleString();
      }
      
      if (document.getElementById('discountBadge') && product.originalPrice && product.originalPrice > product.price) {
        const discount = Math.round(((product.originalPrice - product.price) / product.originalPrice) * 100);
        document.getElementById('discountBadge').textContent = discount + '% OFF';
      }
      
      if (document.getElementById('mainProductImage')) {
        document.getElementById('mainProductImage').src = product.image;
      }
      
      document.querySelectorAll('.thumbnail').forEach((thumb, index) => {
        if (index === 0) thumb.src = product.image;
      });
      
      // Update breadcrumb
      const breadcrumbName = document.getElementById('breadcrumbProductName');
      if (breadcrumbName) {
        breadcrumbName.textContent = product.name;
      }
      
      // Update product description if available
      if (product.description && document.getElementById('productDescription')) {
        document.getElementById('productDescription').textContent = product.description;
      }
      
      // Update stock indicator
      if (product.stock !== undefined) {
        updateStockIndicator(product);
      }
    }

    // Change main image
    function changeMainImage(src) {
      document.getElementById('mainProductImage').src = src;
      document.querySelectorAll('.thumbnail').forEach(thumb => {
        thumb.classList.remove('active');
        if (thumb.src === src || thumb.getAttribute('src') === src) {
          thumb.classList.add('active');
        }
      });
    }

    // Select color - with image preview
    function selectColor(element) {
      document.querySelectorAll('.color-option').forEach(opt => opt.classList.remove('active'));
      element.classList.add('active');
      
      // Update main image when color is selected
      const colorImg = element.querySelector('img');
      if (colorImg && colorImg.src) {
        changeMainImage(colorImg.src);
      }
    }
    
    // Quantity Management - Make it work!
    window.changeQuantity = function(delta) {
      const qtyInput = document.getElementById('quantityInput');
      if (!qtyInput) return;
      
      let currentQty = parseInt(qtyInput.value) || 1;
      let newQty = currentQty + delta;
      
      // Enforce min and max
      if (newQty < 1) newQty = 1;
      if (newQty > 10) newQty = 10;
      
      // Update input value
      qtyInput.value = newQty;
      
      // Update button states
      updateQuantityButtons();
      
      // Visual feedback
      qtyInput.style.transform = 'scale(1.1)';
      qtyInput.style.transition = 'transform 0.2s';
      setTimeout(() => {
        qtyInput.style.transform = 'scale(1)';
      }, 200);
      
      console.log('Quantity changed to:', newQty);
    };
    
    window.updateQuantity = function(value) {
      const qtyInput = document.getElementById('quantityInput');
      if (!qtyInput) return;
      
      let qty = parseInt(value) || 1;
      if (qty < 1) qty = 1;
      if (qty > 10) qty = 10;
      
      qtyInput.value = qty;
      updateQuantityButtons();
    };
    
    function updateQuantityButtons() {
      const decreaseBtn = document.getElementById('decreaseQty');
      const increaseBtn = document.getElementById('increaseQty');
      const qtyInput = document.getElementById('quantityInput');
      
      if (!qtyInput) return;
      
      const currentQty = parseInt(qtyInput.value) || 1;
      
      if (decreaseBtn) {
        decreaseBtn.disabled = (currentQty <= 1);
        if (currentQty <= 1) {
          decreaseBtn.style.opacity = '0.4';
          decreaseBtn.style.cursor = 'not-allowed';
        } else {
          decreaseBtn.style.opacity = '1';
          decreaseBtn.style.cursor = 'pointer';
        }
      }
      
      if (increaseBtn) {
        increaseBtn.disabled = (currentQty >= 10);
        if (currentQty >= 10) {
          increaseBtn.style.opacity = '0.4';
          increaseBtn.style.cursor = 'not-allowed';
        } else {
          increaseBtn.style.opacity = '1';
          increaseBtn.style.cursor = 'pointer';
        }
      }
    }
    
    // Compatibility functions
    function changeQuantity(delta) {
      return window.changeQuantity(delta);
    }
    
    function updateQuantity(value) {
      return window.updateQuantity(value);
    }

    // Select size - fully functional and robust
    window.selectSize = function(element, price) {
      try {
        // Handle event-based calls
        if (element && element.target) {
          element = element.target.closest('.size-btn') || element.target;
        }
        
        // If clicked on child element, find parent button
        if (element && !element.classList.contains('size-btn')) {
          element = element.closest('.size-btn');
        }
        
        if (!element || !element.classList) {
          console.error('Invalid size element');
          return false;
        }
        
        // Get price from element if not provided
        if (!price || isNaN(price)) {
          price = parseInt(element.getAttribute('data-price') || element.dataset.price || 0);
        }
        
        if (!price || isNaN(price)) {
          console.error('Invalid price');
          return false;
        }
        
        // Get size from element
        const sizeText = element.getAttribute('data-size') || element.dataset.size || (element.querySelector('div:first-child') ? element.querySelector('div:first-child').textContent.trim() : '');
        
        console.log('Selecting size:', sizeText, 'Price:', price);
        
        // Remove active class and styles from ALL size buttons
        document.querySelectorAll('.size-btn').forEach(btn => {
          btn.classList.remove('active');
          btn.style.borderColor = '';
          btn.style.background = '';
          btn.style.color = '';
          btn.style.transform = '';
          btn.style.boxShadow = '';
          
          // Reset price color
          const priceEl = btn.querySelector('.size-price');
          if (priceEl) {
            priceEl.style.color = '#e53935';
            priceEl.style.fontWeight = '600';
          }
          
          // Reset aria attributes
          btn.setAttribute('aria-pressed', 'false');
          btn.setAttribute('aria-selected', 'false');
        });
        
        // Add active class to selected size
        element.classList.add('active');
        
        // Apply active styles - FORCE them with !important equivalent
        element.style.borderColor = '#ff6d2e';
        element.style.background = '#ff6d2e';
        element.style.color = '#fff';
        element.style.boxShadow = '0 4px 12px rgba(255, 109, 46, 0.3)';
        
        // Update price color in selected button
        const selectedPriceEl = element.querySelector('.size-price');
        if (selectedPriceEl) {
          selectedPriceEl.style.color = '#fff';
          selectedPriceEl.style.fontWeight = '700';
        }
        
        // Update the current price display
        const currentPriceEl = document.getElementById('currentPrice');
        if (currentPriceEl && price) {
          // Animate price change
          currentPriceEl.style.transition = 'all 0.3s ease';
          currentPriceEl.style.opacity = '0.6';
          setTimeout(() => {
            currentPriceEl.textContent = '₹' + price;
            currentPriceEl.style.opacity = '1';
            currentPriceEl.style.color = '#e53935';
          }, 150);
        }
        
        // Store selected size for cart
        element.dataset.selectedSize = sizeText;
        
        // Visual feedback with animation
        element.style.transform = 'scale(1.05)';
        element.style.transition = 'all 0.3s ease';
        setTimeout(() => {
          element.style.transform = 'scale(1)';
        }, 200);
        
        // Update aria attributes for accessibility
        element.setAttribute('aria-pressed', 'true');
        element.setAttribute('aria-selected', 'true');
        
        // Force highlight again to ensure it stays
        setTimeout(() => {
          element.classList.add('active');
          element.style.borderColor = '#ff6d2e';
          element.style.background = '#ff6d2e';
          element.style.color = '#fff';
          if (selectedPriceEl) {
            selectedPriceEl.style.color = '#fff';
          }
        }, 50);
        
        console.log('✓ Size selected successfully:', sizeText, 'Price: ₹' + price);
        return true;
      } catch (error) {
        console.error('Error in selectSize:', error);
        return false;
      }
    };
    
    // Also create a regular function for compatibility
    function selectSize(element, price) {
      return window.selectSize(element, price);
    }

    // Toggle info sections
    function toggleSection(sectionId) {
      const section = document.getElementById(sectionId);
      if (!section) return;
      
      const svg = section.querySelector('.info-header svg');
      const isActive = section.classList.contains('active');
      
      // Toggle active state
      section.classList.toggle('active');
      
      // Rotate arrow icon
      if (svg) {
        if (section.classList.contains('active')) {
          svg.style.transform = 'rotate(180deg)';
        } else {
          svg.style.transform = 'rotate(0deg)';
        }
      }
      
      // Smooth scroll to section if opening
      if (!isActive && section.classList.contains('active')) {
        setTimeout(() => {
          section.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }, 100);
      }
    }

    // Check delivery
    function checkDelivery() {
      const pincodeInput = document.getElementById('pincodeInput');
      const messageEl = document.getElementById('deliveryMessage');
      const checkBtn = document.querySelector('.check-delivery-btn');
      
      if (!pincodeInput || !messageEl) {
        console.error('Pincode input or message element not found');
        return;
      }
      
      const pincode = pincodeInput.value.trim();
      
      // Clear previous messages
      messageEl.innerHTML = '';
      
      // Validation: Empty check
      if (!pincode) {
        messageEl.textContent = 'Please enter a pincode';
        messageEl.style.color = '#e53935';
        messageEl.style.fontSize = '0.9rem';
        pincodeInput.focus();
        pincodeInput.style.borderColor = '#e53935';
        return;
      }
      
      // Validation: Length and format check
      if (pincode.length !== 6 || !/^\d{6}$/.test(pincode)) {
        messageEl.textContent = 'Please enter a valid 6-digit pincode';
        messageEl.style.color = '#e53935';
        messageEl.style.fontSize = '0.9rem';
        pincodeInput.focus();
        pincodeInput.style.borderColor = '#e53935';
        return;
      }
      
      // Reset border color
      pincodeInput.style.borderColor = '';
      
      // Disable button during check
      if (checkBtn) {
        checkBtn.disabled = true;
        checkBtn.textContent = 'Checking...';
        checkBtn.style.opacity = '0.7';
      }
      
      // Show loading message
      messageEl.innerHTML = '<span style="color: #ff6d2e;">⏳ Checking delivery availability...</span>';
      messageEl.style.fontSize = '0.9rem';
      
      // Simulate API call
      setTimeout(() => {
        // Mock delivery check - in real app, this would be an API call
        const serviceablePincodes = [
          '411001', '411002', '411003', '411004', '411005', 
          '411006', '411007', '411008', '411009', '411010',
          '400001', '400002', '400003', '400004', '400005',
          '110001', '110002', '110003', '110004', '110005',
          '560001', '560002', '560003', '560004', '560005'
        ];
        
        const isServiceable = serviceablePincodes.includes(pincode);
        
        // Re-enable button
        if (checkBtn) {
          checkBtn.disabled = false;
          checkBtn.textContent = 'Check';
          checkBtn.style.opacity = '1';
        }
        
        if (isServiceable) {
          messageEl.innerHTML = '✓ <strong style="color: #4caf50;">Delivery available</strong> to this pincode<br><span style="font-size: 0.85rem;">Expected delivery: 3-5 business days</span>';
          messageEl.style.color = '#4caf50';
          pincodeInput.style.borderColor = '#4caf50';
        } else {
          messageEl.innerHTML = '⚠ <strong style="color: #ff9800;">Delivery not available</strong> to this pincode<br><span style="font-size: 0.85rem;">Please contact us at +91 7588933972 for alternative delivery options</span>';
          messageEl.style.color = '#ff9800';
          pincodeInput.style.borderColor = '#ff9800';
        }
        messageEl.style.fontSize = '0.9rem';
      }, 1000);
    }

    // Add to cart - fully functional with quantity
    function addToCart() {
      try {
        const product = getProductFromURL();
        
        // Get selected size - REQUIRED
        const selectedSizeBtn = document.querySelector('.size-btn.active');
        if (!selectedSizeBtn) {
          // Show error message
          const sizeSection = document.querySelector('.size-section');
          if (sizeSection) {
            sizeSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
            // Highlight size section
            sizeSection.style.border = '2px solid #e53935';
            sizeSection.style.borderRadius = '8px';
            sizeSection.style.padding = '12px';
            sizeSection.style.transition = 'all 0.3s';
            setTimeout(() => {
              sizeSection.style.border = '';
              sizeSection.style.padding = '';
            }, 3000);
          }
          
          // Show alert
          const alertMsg = document.createElement('div');
          alertMsg.textContent = '⚠️ Please select a size first';
          alertMsg.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #e53935; color: white; padding: 16px 24px; border-radius: 8px; z-index: 10000; box-shadow: 0 4px 12px rgba(0,0,0,0.3); font-weight: 600; animation: slideIn 0.3s ease;';
          document.body.appendChild(alertMsg);
          setTimeout(() => {
            alertMsg.style.opacity = '0';
            alertMsg.style.transition = 'opacity 0.3s';
            setTimeout(() => alertMsg.remove(), 300);
          }, 3000);
          return false;
        }
        
        const size = selectedSizeBtn.querySelector('div:first-child').textContent.trim();
        const price = parseInt(selectedSizeBtn.dataset.price) || product.price;
        
        // Get quantity
        const qtyInput = document.getElementById('quantityInput');
        const quantity = qtyInput ? parseInt(qtyInput.value) || 1 : 1;
        
        // Get selected color (optional)
        const selectedColor = document.querySelector('.color-option.active');
        const color = selectedColor ? (selectedColor.querySelector('img').alt || 'Default') : 'Default';
        
        // Get cart from localStorage
        let cart = JSON.parse(localStorage.getItem('cart') || '[]');
        
        // Create unique item identifier
        const itemId = `${product.name}_${size}_${color}`;
        
        // Check if item already exists in cart
        const existingItemIndex = cart.findIndex(item => 
          item.name === product.name && 
          item.size === size && 
          (item.color || 'Default') === color
        );
        
        if (existingItemIndex !== -1) {
          // Update quantity if item already exists
          cart[existingItemIndex].quantity += quantity;
        } else {
          // Add new item to cart
          cart.push({
            id: itemId,
            name: product.name,
            price: price,
            originalPrice: product.originalPrice || price,
            image: product.image,
            size: size,
            color: color,
            brand: product.brand || 'V Store',
            quantity: quantity
          });
        }
        
        // Save cart to localStorage
        localStorage.setItem('cart', JSON.stringify(cart));
        console.log('Cart updated:', cart);
        
        // Update cart count in navbar
        const totalItems = cart.reduce((sum, item) => sum + (item.quantity || 1), 0);
        const cartCount = document.getElementById('cartCount');
        if (cartCount) {
          cartCount.textContent = totalItems;
          // Animate cart count
          cartCount.style.transform = 'scale(1.3)';
          cartCount.style.transition = 'transform 0.3s';
          setTimeout(() => {
            cartCount.style.transform = '';
          }, 300);
        }
        
        // Show success feedback on button
        const btn = document.getElementById('addToCartBtn') || document.querySelector('.btn-add-cart');
        if (btn) {
          const originalText = btn.innerHTML;
          btn.innerHTML = '✓ Added to Cart!';
          btn.style.background = '#4caf50';
          btn.style.color = '#fff';
          btn.style.borderColor = '#4caf50';
          btn.disabled = true;
          
          // Show success notification
          const successMsg = document.createElement('div');
          successMsg.innerHTML = `✓ <strong>${quantity} x ${product.name}</strong> (Size: ${size}) added to cart!`;
          successMsg.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #4caf50; color: white; padding: 16px 24px; border-radius: 8px; z-index: 10000; box-shadow: 0 4px 12px rgba(0,0,0,0.3); font-weight: 600; max-width: 300px; animation: slideIn 0.3s ease;';
          document.body.appendChild(successMsg);
          
          setTimeout(() => {
            btn.innerHTML = originalText;
            btn.style.background = '';
            btn.style.color = '';
            btn.style.borderColor = '';
            btn.disabled = false;
            
            successMsg.style.opacity = '0';
            successMsg.style.transition = 'opacity 0.3s';
            setTimeout(() => successMsg.remove(), 300);
          }, 2000);
        }
        
        // Call updateCartCount if function exists (from app.js)
        if (typeof updateCartCount === 'function') {
          updateCartCount();
        }
        
        return true;
      } catch (error) {
        console.error('Error adding to cart:', error);
        const errorMsg = document.createElement('div');
        errorMsg.textContent = '❌ Error adding product to cart. Please try again.';
        errorMsg.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #e53935; color: white; padding: 16px 24px; border-radius: 8px; z-index: 10000; box-shadow: 0 4px 12px rgba(0,0,0,0.3); font-weight: 600;';
        document.body.appendChild(errorMsg);
        setTimeout(() => {
          errorMsg.style.opacity = '0';
          errorMsg.style.transition = 'opacity 0.3s';
          setTimeout(() => errorMsg.remove(), 300);
        }, 3000);
        return false;
      }
    }

    // Buy now - adds to cart and redirects
    function buyNow() {
      const buyBtn = document.getElementById('buyNowBtn') || document.querySelector('.btn-buy-now');
      
      // Disable button during processing
      if (buyBtn) {
        buyBtn.disabled = true;
        buyBtn.style.opacity = '0.7';
      }
      
      // Add to cart first
      const added = addToCart();
      
      if (added) {
        // Show loading message
        if (buyBtn) {
          buyBtn.innerHTML = 'Redirecting...';
        }
        
        // Small delay to show success message, then redirect
        setTimeout(() => {
          window.location.href = 'cart.html';
        }, 800);
      } else {
        // Re-enable button if add failed
        if (buyBtn) {
          buyBtn.disabled = false;
          buyBtn.style.opacity = '1';
        }
        // If size not selected, don't redirect (error already shown by addToCart)
        return false;
      }
    }

    // Helper function to update wishlist button icon
    function updateWishlistButtonIconDetail(button, isWishlisted) {
      if (isWishlisted) {
        // Replace with GIF
        button.innerHTML = `<img src="../assets/gifs/wishlist.gif" alt="Wishlisted" style="width: 20px; height: 20px; object-fit: contain;" />`;
        button.title = 'Remove from Wishlist';
        button.classList.add('active');
      } else {
        // Replace with SVG
        button.innerHTML = `<svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
        </svg>`;
        button.title = 'Add to Wishlist';
        button.classList.remove('active');
      }
    }

    // Wishlist toggle
    function initWishlist() {
      const wishlistBtn = document.getElementById('productWishlistBtn');
      if (!wishlistBtn) return;
      
      const product = getProductFromURL();
      
      // Check if product is already in wishlist using WishlistUtils if available
      let isInWishlist = false;
      if (window.WishlistUtils) {
        const wishlist = window.WishlistUtils.getWishlist();
        isInWishlist = wishlist.some(item => item.name === product.name);
      } else {
        const wishlist = JSON.parse(localStorage.getItem('wishlist') || '[]');
        isInWishlist = wishlist.some(item => item.name === product.name);
      }
      
      updateWishlistButtonIconDetail(wishlistBtn, isInWishlist);
      
      wishlistBtn.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        
        const product = getProductFromURL();
        
        if (window.WishlistUtils) {
          const wishlist = window.WishlistUtils.getWishlist();
          const productIndex = wishlist.findIndex(item => item.name === product.name);
          
          if (productIndex !== -1) {
            // Remove from wishlist
            window.WishlistUtils.removeItemFromWishlist(product.name);
            updateWishlistButtonIconDetail(this, false);
            if (window.showToast) {
              showToast(`${product.name} removed from wishlist`, 'success', 'Wishlist');
            }
          } else {
            // Add to wishlist
            const added = window.WishlistUtils.addItemToWishlist({
              name: product.name,
              price: product.price,
              originalPrice: product.originalPrice || product.price,
              image: product.image,
              brand: product.brand,
              size: 'Default',
              color: 'Default'
            });
            
            if (added) {
              updateWishlistButtonIconDetail(this, true);
              if (window.showToast) {
                showToast(`${product.name} added to wishlist!`, 'success', 'Wishlist');
              }
            }
          }
          
          window.WishlistUtils.updateWishlistCount();
        } else {
          // Fallback to localStorage
          let wishlist = JSON.parse(localStorage.getItem('wishlist') || '[]');
          const productIndex = wishlist.findIndex(item => item.name === product.name);
          
          if (productIndex !== -1) {
            // Remove from wishlist
            wishlist.splice(productIndex, 1);
            localStorage.setItem('wishlist', JSON.stringify(wishlist));
            updateWishlistButtonIconDetail(this, false);
            if (window.showToast) {
              showToast(`${product.name} removed from wishlist`, 'success', 'Wishlist');
            }
          } else {
            // Add to wishlist
            wishlist.push({
              name: product.name,
              price: product.price,
              originalPrice: product.originalPrice || product.price,
              image: product.image,
              brand: product.brand
            });
            localStorage.setItem('wishlist', JSON.stringify(wishlist));
            updateWishlistButtonIconDetail(this, true);
            if (window.showToast) {
              showToast(`${product.name} added to wishlist!`, 'success', 'Wishlist');
            }
          }
          
          // Update wishlist count
          const wishlistCountElements = document.querySelectorAll('#wishlistCount, .wishlist-count');
          wishlistCountElements.forEach(el => {
            if (el) {
              el.textContent = wishlist.length;
              if (wishlist.length > 0) {
                el.style.display = 'inline-block';
              } else {
                el.style.display = 'none';
              }
            }
          });
        }
      });
    }

    // Pincode input validation and form handling
    function initPincodeForm() {
      const pincodeInput = document.getElementById('pincodeInput');
      const checkBtn = document.querySelector('.check-delivery-btn');
      const messageEl = document.getElementById('deliveryMessage');
      
      if (!pincodeInput) {
        console.error('Pincode input not found');
        return;
      }
      
      // Real-time input validation - only numbers, max 6 digits
      pincodeInput.addEventListener('input', function(e) {
        this.value = this.value.replace(/\D/g, '').slice(0, 6);
        
        // Clear error message when user starts typing
        if (messageEl && this.value.length > 0) {
          const currentMessage = messageEl.textContent || messageEl.innerHTML;
          if (currentMessage.includes('Please enter') || currentMessage.includes('valid')) {
            messageEl.innerHTML = '';
            this.style.borderColor = '';
          }
        }
        
        // Auto-check when 6 digits are entered
        if (this.value.length === 6) {
          // Optional: auto-check after a short delay
          // setTimeout(() => checkDelivery(), 500);
        }
      });

      // Enter key to check delivery
      pincodeInput.addEventListener('keydown', function(e) {
        if (e.key === 'Enter') {
          e.preventDefault();
          checkDelivery();
        }
      });
      
      // Button click handler
      if (checkBtn) {
        checkBtn.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          checkDelivery();
        });
      }
      
      // Clear message on focus
      pincodeInput.addEventListener('focus', function() {
        if (messageEl && messageEl.textContent.includes('Please enter')) {
          messageEl.innerHTML = '';
          this.style.borderColor = '';
        }
      });
    }

    // Mobile Menu Toggle
    const mobileMenuBtn = document.getElementById("mobileMenuBtn");
    const mobileNav = document.getElementById("mobileNav");
    if (mobileMenuBtn && mobileNav) {
      mobileMenuBtn.addEventListener("click", () => {
        mobileNav.classList.toggle("active");
      });
      document.addEventListener("click", (e) => {
        if (!mobileMenuBtn.contains(e.target) && !mobileNav.contains(e.target)) {
          mobileNav.classList.remove("active");
        }
      });
      mobileNav.querySelectorAll(".nav-item").forEach(item => {
        item.addEventListener("click", () => {
          mobileNav.classList.remove("active");
        });
      });
    }

    // ====== PROFILE SIDEBAR SYSTEM ======
    const profileSidebar = document.getElementById('profileSidebar');
    const profileSidebarOverlay = document.getElementById('profileSidebarOverlay');
    const profileSidebarClose = document.getElementById('profileSidebarClose');
    const loginDropdownBtn = document.getElementById('loginDropdownBtn');
    const loginDropdown = document.getElementById('loginDropdown');
    const lightModeBtn = document.getElementById('lightModeBtn');
    const sidebarLightModeBtn = document.getElementById('sidebarLightMode');

    function getCurrentUser() {
      return JSON.parse(localStorage.getItem('currentUser') || 'null');
    }

    function updateProfileSidebar() {
      const user = getCurrentUser();
      const sidebarName = document.querySelector('.profile-sidebar-name');
      const sidebarPhone = document.querySelector('.profile-sidebar-phone');
      const sidebarAvatar = document.querySelector('.profile-sidebar-avatar');
      
      if (user) {
        if (sidebarName) sidebarName.textContent = `Hello ${user.name || 'User'}`;
        if (sidebarPhone) sidebarPhone.textContent = user.phone || user.email || 'Not provided';
        if (sidebarAvatar) {
          sidebarAvatar.innerHTML = `<span style="font-size: 1.5rem; font-weight: 700; color: #ff6d2e;">${(user.name || 'U')[0].toUpperCase()}</span>`;
        }
        
        const signOutBtn = document.getElementById('sidebarSignOut');
        if (signOutBtn) signOutBtn.style.display = 'flex';
      } else {
        if (sidebarName) sidebarName.textContent = 'Hello Guest';
        if (sidebarPhone) sidebarPhone.textContent = 'Sign in to continue';
        if (sidebarAvatar) {
          sidebarAvatar.innerHTML = `
            <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
          `;
        }
        
        const signOutBtn = document.getElementById('sidebarSignOut');
        if (signOutBtn) signOutBtn.style.display = 'none';
      }
    }

    function handleSignOut() {
      if (window.showConfirmDialog) {
        window.showConfirmDialog('Are you sure you want to sign out?', 'Sign Out').then((confirmed) => {
          if (confirmed) {
            localStorage.removeItem('currentUser');
            updateProfileSidebar();
            if (window.showToast) {
              showToast('Signed out successfully', 'success', 'Sign Out');
            }
            closeProfileSidebar();
            setTimeout(() => {
              window.location.href = 'login.html';
            }, 500);
          }
        });
      } else if (confirm('Are you sure you want to sign out?')) {
        localStorage.removeItem('currentUser');
        updateProfileSidebar();
        if (window.showToast) {
          showToast('Signed out successfully', 'success', 'Sign Out');
        }
        closeProfileSidebar();
        setTimeout(() => {
          window.location.href = 'login.html';
        }, 500);
      }
    }

    function openProfileSidebar() {
      if (profileSidebar) {
        updateProfileSidebar();
        profileSidebar.classList.add('active');
        if (profileSidebarOverlay) {
          profileSidebarOverlay.classList.add('active');
        }
        document.body.style.overflow = 'hidden';
      }
    }

    function closeProfileSidebar() {
      if (profileSidebar) {
        profileSidebar.classList.remove('active');
        if (profileSidebarOverlay) {
          profileSidebarOverlay.classList.remove('active');
        }
        document.body.style.overflow = '';
      }
    }

    window.openProfileSidebar = openProfileSidebar;
    window.closeProfileSidebar = closeProfileSidebar;
    window.handleSignOut = handleSignOut;

    // Profile Dropdown Toggle

    if (loginDropdownBtn && loginDropdown) {
      loginDropdownBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        e.preventDefault();
        openProfileSidebar();
      });

      document.addEventListener('click', function(e) {
        if (!loginDropdownBtn.contains(e.target) && !loginDropdown.contains(e.target)) {
          loginDropdown.classList.remove('active');
        }
      });

      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && loginDropdown.classList.contains('active')) {
          loginDropdown.classList.remove('active');
        }
      });
    }

    if (lightModeBtn) {
      lightModeBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        const darkModeSwitch = document.getElementById('dark-mode-switch');
        if (darkModeSwitch) {
          darkModeSwitch.checked = !darkModeSwitch.checked;
          darkModeSwitch.dispatchEvent(new Event('change'));
        }
      });
    }

    function updateLightModeText() {
      const lightModeText = document.getElementById('lightModeText');
      if (lightModeText) {
        const isDarkMode = document.body.classList.contains('dark-mode');
        lightModeText.textContent = isDarkMode ? 'Light Mode' : 'Dark Mode';
      }
    }

    // Update on theme change (wait for app.js to initialize first)
    function setupLightModeTextUpdate() {
      const darkModeSwitch = document.getElementById('dark-mode-switch');
      if (!darkModeSwitch) {
        setTimeout(setupLightModeTextUpdate, 50);
        return;
      }
      darkModeSwitch.addEventListener('change', function() {
        requestAnimationFrame(updateLightModeText);
      });
      updateLightModeText();
    }
    
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => {
        setTimeout(setupLightModeTextUpdate, 150);
      });
    } else {
      setTimeout(setupLightModeTextUpdate, 150);
    }

    // Search functionality
    const searchBtn = document.getElementById('searchBtn');
    const searchModal = document.getElementById('searchModal');
    const searchClose = document.getElementById('searchClose');
    const searchInput = document.getElementById('searchInput');
    const searchResults = document.getElementById('searchResults');

    if (searchBtn && searchModal) {
      searchBtn.addEventListener('click', () => {
        searchModal.style.display = 'flex';
        setTimeout(() => searchInput?.focus(), 100);
      });
    }

    if (searchClose) {
      searchClose.addEventListener('click', () => {
        searchModal.style.display = 'none';
        if (searchInput) searchInput.value = '';
        if (searchResults) searchResults.innerHTML = '';
      });
    }

    if (searchModal) {
      searchModal.addEventListener('click', (e) => {
        if (e.target === searchModal) {
          searchModal.style.display = 'none';
          if (searchInput) searchInput.value = '';
          if (searchResults) searchResults.innerHTML = '';
        }
      });
    }

    // Product search data
    const allProducts = [
      { name: 'Colourblocked Polo T-shirt', price: 593, img: 'product-detail.html?name=Colourblocked%20Polo%20T-shirt&price=593&originalPrice=1099&image=../assets/all_products/q1.jpg&brand=Allen%20Solly', brand: 'Allen Solly' },
      { name: 'Pure Cotton Custom Fit Shirt', price: 917, img: 'product-detail.html?name=Pure%20Cotton%20Custom%20Fit%20Shirt&price=917&originalPrice=1799&image=../assets/all_products/q3.jpg&brand=Allen%20Solly', brand: 'Allen Solly' },
      { name: 'Polo Collar Slim Fit T-shirt', price: 929, img: 'product-detail.html?name=Polo%20Collar%20Slim%20Fit%20T-shirt&price=929&originalPrice=1499&image=../assets/all_products/q4.jpg&brand=Louis%20Philippe%20Jeans', brand: 'Louis Philippe Jeans' },
      { name: 'Pure Cotton Casual Shirt', price: 993, img: 'product-detail.html?name=Pure%20Cotton%20Casual%20Shirt&price=993&originalPrice=1949&image=../assets/all_products/q5.jpg&brand=Allen%20Solly', brand: 'Allen Solly' },
      { name: 'Classic Fit Formal Shirt', price: 849, img: 'product-detail.html?name=Classic%20Fit%20Formal%20Shirt&price=849&originalPrice=1599&image=../assets/all_products/q1.jpg&brand=Louis%20Philippe%20Jeans', brand: 'Louis Philippe Jeans' },
      { name: 'Regular Fit Cotton T-shirt', price: 699, img: 'product-detail.html?name=Regular%20Fit%20Cotton%20T-shirt&price=699&originalPrice=1299&image=../assets/all_products/q4.jpg&brand=Allen%20Solly', brand: 'Allen Solly' },
      { name: 'Slim Fit Cotton Shirt', price: 799, img: 'product-detail.html?name=Slim%20Fit%20Cotton%20Shirt&price=799&originalPrice=1499&image=../assets/all_products/q3.jpg&brand=Louis%20Philippe%20Jeans', brand: 'Louis Philippe Jeans' },
      { name: 'Oversized Graphic Tee', price: 499, img: 'product-detail.html?name=Oversized%20Graphic%20Tee&price=499&originalPrice=1099&image=../assets/genz/ts.webp&brand=V%20Store', brand: 'V Store' },
      { name: 'Minimalist Hoodie', price: 799, img: 'product-detail.html?name=Minimalist%20Hoodie&price=799&originalPrice=1499&image=../assets/genz/hd.webp&brand=V%20Store', brand: 'V Store' },
      { name: 'Baggy Fit Jeans', price: 999, img: 'product-detail.html?name=Baggy%20Fit%20Jeans&price=999&originalPrice=1799&image=../assets/genz/Bg.jpg&brand=V%20Store', brand: 'V Store' },
      { name: 'Co-ord Set', price: 1199, img: 'product-detail.html?name=Co-ord%20Set&price=1199&originalPrice=1999&image=../assets/genz/cd.webp&brand=V%20Store', brand: 'V Store' },
      { name: "Men's Pure Cotton T-Shirt", price: 476, img: 'product-detail.html?name=Men%27s%20Pure%20Cotton%20T-Shirt&price=476&originalPrice=1499&image=../assets/products/p1.jpg&brand=V%20Store', brand: 'V Store' }
    ];

    function performSearch(query) {
      const lowerQuery = query.toLowerCase().trim();
      if (lowerQuery === '') {
        if (searchResults) searchResults.innerHTML = '';
        return;
      }

      const filtered = allProducts.filter(p => 
        p.name.toLowerCase().includes(lowerQuery) ||
        p.brand.toLowerCase().includes(lowerQuery)
      );

      if (!searchResults) return;
      searchResults.innerHTML = '';
      
      if (filtered.length === 0) {
        searchResults.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-color, #666);">No products found</div>';
        return;
      }

      filtered.forEach(product => {
        const item = document.createElement('div');
        item.style.cssText = 'padding: 12px; border-bottom: 1px solid rgba(0,0,0,0.1); cursor: pointer; transition: background-color 0.2s; display: flex; align-items: center; gap: 12px;';
        item.innerHTML = `
          <div style="flex: 1;">
            <h4 style="margin: 0 0 4px 0; color: var(--text-color, #333); font-size: 1rem;">${product.name}</h4>
            <p style="margin: 0; color: #e53935; font-weight: 600; font-size: 0.9rem;">₹${product.price}</p>
            <p style="margin: 4px 0 0 0; color: var(--text-color, #666); font-size: 0.85rem;">${product.brand}</p>
          </div>
        `;
        item.addEventListener('mouseenter', () => {
          item.style.background = 'var(--muted-white, #f5f5f5)';
        });
        item.addEventListener('mouseleave', () => {
          item.style.background = 'transparent';
        });
        item.addEventListener('click', () => {
          window.location.href = product.img;
          searchModal.style.display = 'none';
          if (searchInput) searchInput.value = '';
          searchResults.innerHTML = '';
        });
        searchResults.appendChild(item);
      });
    }

    if (searchInput) {
      searchInput.addEventListener('input', (e) => {
        performSearch(e.target.value);
      });

      searchInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && searchInput.value.trim()) {
          const filtered = allProducts.filter(p => 
            p.name.toLowerCase().includes(searchInput.value.toLowerCase().trim()) ||
            p.brand.toLowerCase().includes(searchInput.value.toLowerCase().trim())
          );
          if (filtered.length > 0) {
            window.location.href = filtered[0].img;
          }
        }
        if (e.key === 'Escape') {
          searchModal.style.display = 'none';
          if (searchInput) searchInput.value = '';
          if (searchResults) searchResults.innerHTML = '';
        }
      });
    }

    // Update cart count on page load
    function updateCartCountOnLoad() {
      const cart = JSON.parse(localStorage.getItem('cart') || '[]');
      const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
      const cartCount = document.getElementById('cartCount');
      if (cartCount) {
        cartCount.textContent = totalItems;
      }
    }

    // Load product data on page load
    document.addEventListener('DOMContentLoaded', function() {
      // Load product data from URL
      loadProductData();
      
      // Initialize wishlist
      initWishlist();
      
      // Initialize pincode form
      initPincodeForm();
      
      // Initialize size chart modal
      initSizeChartModal();
      
      // Initialize quantity buttons
      if (typeof updateQuantityButtons === 'function') {
        updateQuantityButtons();
      }
      
      // Set up quantity button event listeners (backup to onclick)
      const decreaseBtn = document.getElementById('decreaseQty');
      const increaseBtn = document.getElementById('increaseQty');
      const qtyInput = document.getElementById('quantityInput');
      
      if (decreaseBtn) {
        decreaseBtn.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          if (window.changeQuantity) {
            window.changeQuantity(-1);
          } else if (typeof changeQuantity === 'function') {
            changeQuantity(-1);
          }
        });
      }
      
      if (increaseBtn) {
        increaseBtn.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          if (window.changeQuantity) {
            window.changeQuantity(1);
          } else if (typeof changeQuantity === 'function') {
            changeQuantity(1);
          }
        });
      }
      
      if (qtyInput) {
        qtyInput.addEventListener('input', function() {
          if (window.updateQuantity) {
            window.updateQuantity(this.value);
          } else if (typeof updateQuantity === 'function') {
            updateQuantity(this.value);
          }
        });
        
        qtyInput.addEventListener('blur', function() {
          let val = parseInt(this.value) || 1;
          if (val < 1) val = 1;
          if (val > 10) val = 10;
          this.value = val;
          updateQuantityButtons();
        });
      }
      
      // Initialize button states
      updateQuantityButtons();
      
      // Update cart count
      updateCartCountOnLoad();
      
      // Ensure size selection is working
      const defaultSizeBtn = document.querySelector('.size-btn.active');
      if (defaultSizeBtn) {
        const defaultPrice = parseInt(defaultSizeBtn.dataset.price);
        if (defaultPrice) {
          document.getElementById('currentPrice').textContent = '₹' + defaultPrice;
        }
      }
      
      // Open Product Highlights section by default
      setTimeout(() => {
        const highlightsSection = document.getElementById('highlightsSection');
        if (highlightsSection && !highlightsSection.classList.contains('active')) {
          toggleSection('highlightsSection');
        }
      }, 200);
      
      // Update cart count periodically (in case cart is updated from another tab)
      setInterval(updateCartCountOnLoad, 2000);
      
      // Add visual feedback for size buttons on hover and keyboard support
      document.querySelectorAll('.size-btn').forEach(btn => {
        // Hover effects
        btn.addEventListener('mouseenter', function() {
          if (!this.classList.contains('active')) {
            this.style.borderColor = '#ff6d2e';
            this.style.cursor = 'pointer';
          }
        });
        btn.addEventListener('mouseleave', function() {
          if (!this.classList.contains('active')) {
            this.style.borderColor = '';
          }
        });
        
        // Click handler - PRIMARY method (ensures it always works)
        btn.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          
          const price = parseInt(this.getAttribute('data-price') || this.dataset.price);
          const size = this.getAttribute('data-size') || this.dataset.size;
          
          console.log('Size button clicked:', size, 'Price:', price, 'Element:', this);
          
          if (price && size) {
            // Call selectSize function
            if (window.selectSize) {
              window.selectSize(this, price);
            } else if (typeof selectSize === 'function') {
              selectSize(this, price);
            } else {
              // Fallback: direct implementation
              document.querySelectorAll('.size-btn').forEach(b => {
                b.classList.remove('active');
                b.style.borderColor = '';
                b.style.background = '';
                b.style.color = '';
              });
              this.classList.add('active');
              this.style.borderColor = '#ff6d2e';
              this.style.background = '#ff6d2e';
              this.style.color = '#fff';
              
              const priceEl = this.querySelector('.size-price');
              if (priceEl) {
                priceEl.style.color = '#fff';
              }
              
              const mainPrice = document.getElementById('currentPrice');
              if (mainPrice) {
                mainPrice.textContent = '₹' + price;
              }
            }
          } else {
            console.error('Missing price or size data:', { price, size, element: this });
          }
        });
        
        // Keyboard support (Enter and Space keys)
        btn.addEventListener('keydown', function(e) {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            const price = parseInt(this.dataset.price);
            const size = this.dataset.size;
            if (price && size) {
              selectSize(this, price);
            }
          }
        });
        
        // Focus styles
        btn.addEventListener('focus', function() {
          if (!this.classList.contains('active')) {
            this.style.outline = '2px solid #ff6d2e';
            this.style.outlineOffset = '2px';
          }
        });
        btn.addEventListener('blur', function() {
          this.style.outline = '';
          this.style.outlineOffset = '';
        });
      });
      
      // Ensure all buttons are properly connected
      const addToCartBtn = document.getElementById('addToCartBtn') || document.querySelector('.btn-add-cart');
      const buyNowBtn = document.getElementById('buyNowBtn') || document.querySelector('.btn-buy-now');
      const checkDeliveryBtn = document.getElementById('checkDeliveryBtn') || document.querySelector('.check-delivery-btn');
      
      // Verify cart is accessible
      const testCart = JSON.parse(localStorage.getItem('cart') || '[]');
      console.log('Current cart items:', testCart.length);
      console.log('Add to Cart button:', addToCartBtn ? 'Found' : 'Not found');
      console.log('Buy Now button:', buyNowBtn ? 'Found' : 'Not found');
      console.log('Check Delivery button:', checkDeliveryBtn ? 'Found' : 'Not found');
      console.log('Product detail page initialized successfully');

      // ====== PRODUCT REVIEWS SYSTEM ======
      const product = getProductFromURL();
      const productId = product.name.replace(/\s+/g, '_').toLowerCase();
      
      function getReviews() {
        const reviews = JSON.parse(localStorage.getItem(`reviews_${productId}`) || '[]');
        return reviews;
      }

      function saveReview(review) {
        const reviews = getReviews();
        review.id = Date.now();
        review.date = new Date().toISOString();
        reviews.push(review);
        localStorage.setItem(`reviews_${productId}`, JSON.stringify(reviews));
        return review;
      }

      function renderReviews() {
        const reviews = getReviews();
        const reviewsList = document.getElementById('reviewsList');
        const reviewsCount = document.getElementById('reviewsCount');
        const averageRating = document.getElementById('averageRating');
        const averageStars = document.getElementById('averageStars');

        if (reviews.length === 0) {
          reviewsList.innerHTML = `
            <div class="no-reviews">
              <div class="no-reviews-icon">💬</div>
              <p>No reviews yet. Be the first to review this product!</p>
            </div>
          `;
          averageRating.textContent = '0';
          reviewsCount.textContent = '(0 reviews)';
          averageStars.innerHTML = '';
          return;
        }

        // Calculate average rating
        const avg = reviews.reduce((sum, r) => sum + r.rating, 0) / reviews.length;
        averageRating.textContent = avg.toFixed(1);
        reviewsCount.textContent = `(${reviews.length} ${reviews.length === 1 ? 'review' : 'reviews'})`;

        // Render average stars
        averageStars.innerHTML = '';
        for (let i = 1; i <= 5; i++) {
          const star = document.createElement('div');
          star.className = 'star';
          if (i <= Math.floor(avg)) {
            star.classList.add('filled');
          } else if (i - 0.5 <= avg) {
            star.classList.add('half');
          }
          averageStars.appendChild(star);
        }

        // Render reviews
        reviewsList.innerHTML = reviews
          .sort((a, b) => new Date(b.date) - new Date(a.date))
          .map(review => {
            const date = new Date(review.date);
            const stars = Array.from({ length: 5 }, (_, i) => 
              i < review.rating ? '<div class="star filled"></div>' : '<div class="star"></div>'
            ).join('');
            
            return `
              <div class="review-item">
                <div class="review-header">
                  <div class="reviewer-info">
                    <div class="reviewer-name">${review.name}</div>
                    <div class="review-date">${date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</div>
                  </div>
                  <div class="review-rating">${stars}</div>
                </div>
                <div class="review-text">${review.text}</div>
              </div>
            `;
          }).join('');
      }

      // Review form handlers
      const writeReviewBtn = document.getElementById('writeReviewBtn');
      const reviewForm = document.getElementById('reviewForm');
      const cancelReviewBtn = document.getElementById('cancelReviewBtn');
      const reviewFormElement = document.getElementById('reviewFormElement');

      // Star rating display update
      function updateRatingDisplay() {
        const selectedRating = document.querySelector('input[name="rating"]:checked');
        const ratingDisplay = document.getElementById('ratingDisplay');
        
        if (ratingDisplay) {
          if (selectedRating) {
            const rating = parseInt(selectedRating.value);
            const ratingTexts = {
              5: 'Excellent',
              4: 'Very Good',
              3: 'Good',
              2: 'Fair',
              1: 'Poor'
            };
            ratingDisplay.textContent = `${rating} star${rating > 1 ? 's' : ''} - ${ratingTexts[rating]}`;
            ratingDisplay.style.color = '#ffc107';
            ratingDisplay.style.fontWeight = '600';
          } else {
            ratingDisplay.textContent = 'Select a rating';
            ratingDisplay.style.color = 'var(--text-color, #666)';
            ratingDisplay.style.fontWeight = '500';
          }
        }
      }

      // Initialize review form functionality
      function initReviewForm() {
        // Add event listeners to star rating inputs
        const ratingInputs = document.querySelectorAll('input[name="rating"]');
        if (ratingInputs.length > 0) {
          ratingInputs.forEach(input => {
            input.addEventListener('change', updateRatingDisplay);
          });
        }

        // Character counter for review text
        const reviewText = document.getElementById('reviewText');
        const charCount = document.getElementById('charCount');
        if (reviewText && charCount) {
          reviewText.addEventListener('input', () => {
            const length = reviewText.value.length;
            charCount.textContent = length;
            
            if (length > 500) {
              charCount.style.color = '#e53935';
              reviewText.value = reviewText.value.substring(0, 500);
              charCount.textContent = 500;
            } else if (length >= 10) {
              charCount.style.color = '#4caf50';
            } else {
              charCount.style.color = 'var(--text-color, #666)';
            }
          });
        }

        // Write Review Button Handler
        if (writeReviewBtn && reviewForm) {
          writeReviewBtn.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            console.log('Write Review button clicked');
            reviewForm.classList.add('active');
            reviewForm.style.display = 'block';
            // Scroll to form
            setTimeout(() => {
              reviewForm.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }, 100);
          });
        } else {
          console.error('Write Review button or form not found', { writeReviewBtn, reviewForm });
        }
      }

      // Initialize review form
      initReviewForm();

      // Global function for onclick fallback
      window.openReviewForm = function() {
        const form = document.getElementById('reviewForm');
        const btn = document.getElementById('writeReviewBtn');
        if (form) {
          form.classList.add('active');
          form.style.display = 'block';
          setTimeout(() => {
            form.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
          }, 100);
        } else {
          console.error('Review form not found');
        }
      };

      if (cancelReviewBtn && reviewForm) {
        cancelReviewBtn.addEventListener('click', function(e) {
          e.preventDefault();
          reviewForm.classList.remove('active');
          reviewForm.style.display = 'none';
          if (reviewFormElement) {
            reviewFormElement.reset();
          }
          updateRatingDisplay();
        });
      }

      if (reviewFormElement) {
        reviewFormElement.addEventListener('submit', (e) => {
          e.preventDefault();
          const rating = parseInt(document.querySelector('input[name="rating"]:checked')?.value);
          const name = document.getElementById('reviewerName').value.trim();
          const text = document.getElementById('reviewText').value.trim();

          // Validation
          if (!rating) {
            if (window.showToast) {
              showToast('Please select a star rating', 'error', 'Rating Required');
            } else {
              alert('Please select a star rating');
            }
            return;
          }

          if (!name) {
            if (window.showToast) {
              showToast('Please enter your name', 'error', 'Name Required');
            } else {
              alert('Please enter your name');
            }
            document.getElementById('reviewerName').focus();
            return;
          }

          if (!text) {
            if (window.showToast) {
              showToast('Please write your review', 'error', 'Review Required');
            } else {
              alert('Please write your review');
            }
            document.getElementById('reviewText').focus();
            return;
          }

          if (text.length < 10) {
            if (window.showToast) {
              showToast('Please write at least 10 characters', 'error', 'Review Too Short');
            } else {
              alert('Please write at least 10 characters');
            }
            document.getElementById('reviewText').focus();
            return;
          }

          // Save review
          const review = { rating, name, text };
          saveReview(review);
          renderReviews();
          reviewForm.classList.remove('active');
          reviewFormElement.reset();
          updateRatingDisplay();

          // Scroll to reviews
          setTimeout(() => {
            document.getElementById('reviewsSection').scrollIntoView({ behavior: 'smooth', block: 'start' });
          }, 100);

          if (window.showToast) {
            showToast('Thank you for your review!', 'success', 'Review Submitted');
          } else {
            alert('Thank you for your review!');
          }
        });
      }

      // Initial render
      renderReviews();

      // ====== RECENTLY VIEWED PRODUCTS ======
      function addToRecentlyViewed(productData) {
        let recentlyViewed = JSON.parse(localStorage.getItem('recentlyViewed') || '[]');
        
        // Remove if already exists
        recentlyViewed = recentlyViewed.filter(p => p.name !== productData.name);
        
        // Add to beginning
        recentlyViewed.unshift({
          name: productData.name,
          price: productData.price,
          image: productData.image,
          brand: productData.brand,
          originalPrice: productData.originalPrice
        });
        
        // Keep only last 8 items
        recentlyViewed = recentlyViewed.slice(0, 8);
        
        localStorage.setItem('recentlyViewed', JSON.stringify(recentlyViewed));
        renderRecentlyViewed();
      }

      function renderRecentlyViewed() {
        const recentlyViewed = JSON.parse(localStorage.getItem('recentlyViewed') || '[]');
        const currentProduct = getProductFromURL();
        
        // Filter out current product
        const filtered = recentlyViewed.filter(p => p.name !== currentProduct.name);
        
        if (filtered.length === 0) {
          document.getElementById('recentlyViewedSection').style.display = 'none';
          return;
        }

        document.getElementById('recentlyViewedSection').style.display = 'block';
        const grid = document.getElementById('recentlyViewedGrid');
        
        grid.innerHTML = filtered.slice(0, 4).map(product => {
          const discount = product.originalPrice ? 
            Math.round(((product.originalPrice - product.price) / product.originalPrice) * 100) : 0;
          
          return `
            <div class="recently-viewed-card" onclick="window.location.href='product-detail.html?name=${encodeURIComponent(product.name)}&price=${product.price}&originalPrice=${product.originalPrice || product.price}&image=${encodeURIComponent(product.image)}&brand=${encodeURIComponent(product.brand)}'">
              <img src="${product.image}" alt="${product.name}" loading="lazy">
              <div class="recently-viewed-card-info">
                <div class="recently-viewed-card-name">${product.name}</div>
                <div class="recently-viewed-card-price">₹${product.price}</div>
              </div>
            </div>
          `;
        }).join('');
      }

      // Add current product to recently viewed
      addToRecentlyViewed(getProductFromURL());

      // ====== IMAGE ZOOM FUNCTIONALITY ======
      function openImageZoom(imageSrc) {
        const modal = document.createElement('div');
        modal.className = 'image-zoom-modal';
        modal.innerHTML = `
          <button class="image-zoom-close" onclick="this.closest('.image-zoom-modal').remove(); document.body.style.overflow = '';">×</button>
          <div class="image-zoom-content">
            <img src="${imageSrc}" alt="Zoomed Product" class="image-zoom-img" id="zoomedImage">
          </div>
        `;
        document.body.appendChild(modal);
        document.body.style.overflow = 'hidden';
        modal.classList.add('active');
        
        // Close on click outside
        modal.addEventListener('click', (e) => {
          if (e.target === modal) {
            modal.remove();
            document.body.style.overflow = '';
          }
        });
        
        // Zoom with mouse wheel
        const zoomedImg = modal.querySelector('#zoomedImage');
        let scale = 1;
        zoomedImg.addEventListener('wheel', (e) => {
          e.preventDefault();
          scale += e.deltaY * -0.01;
          scale = Math.min(Math.max(1, scale), 5);
          zoomedImg.style.transform = `scale(${scale})`;
        });
      }
      
      window.openImageZoom = openImageZoom;

      // ====== SIZE GUIDE MODAL ======
      function openSizeGuide() {
        const modal = document.createElement('div');
        modal.className = 'size-guide-modal';
        modal.innerHTML = `
          <div class="size-guide-content">
            <div class="size-guide-header">
              <h2 class="size-guide-title">Size Guide</h2>
              <button class="size-guide-close" onclick="this.closest('.size-guide-modal').remove(); document.body.style.overflow = '';">×</button>
            </div>
            <p style="margin-bottom: 16px; color: var(--text-color, #666);">Find your perfect fit using the measurements below:</p>
            <table class="size-guide-table">
              <thead>
                <tr>
                  <th>Size</th>
                  <th>Chest (inches)</th>
                  <th>Waist (inches)</th>
                  <th>Length (inches)</th>
                  <th>Sleeve (inches)</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><strong>S</strong></td>
                  <td>36-38</td>
                  <td>30-32</td>
                  <td>27</td>
                  <td>24</td>
                </tr>
                <tr>
                  <td><strong>M</strong></td>
                  <td>40-42</td>
                  <td>34-36</td>
                  <td>28</td>
                  <td>25</td>
                </tr>
                <tr>
                  <td><strong>L</strong></td>
                  <td>44-46</td>
                  <td>38-40</td>
                  <td>29</td>
                  <td>26</td>
                </tr>
                <tr>
                  <td><strong>XL</strong></td>
                  <td>48-50</td>
                  <td>42-44</td>
                  <td>30</td>
                  <td>27</td>
                </tr>
                <tr>
                  <td><strong>XXL</strong></td>
                  <td>52-54</td>
                  <td>46-48</td>
                  <td>31</td>
                  <td>28</td>
                </tr>
              </tbody>
            </table>
            <div style="margin-top: 20px; padding: 16px; background: var(--muted-white, #f5f5f5); border-radius: 8px;">
              <h4 style="margin-bottom: 8px; color: var(--text-color, #333);">How to Measure:</h4>
              <ul style="color: var(--text-color, #666); line-height: 1.8; padding-left: 20px;">
                <li><strong>Chest:</strong> Measure around the fullest part of your chest</li>
                <li><strong>Waist:</strong> Measure around your natural waistline</li>
                <li><strong>Length:</strong> Measure from the top of the shoulder to the hem</li>
                <li><strong>Sleeve:</strong> Measure from the shoulder seam to the cuff</li>
              </ul>
            </div>
          </div>
        `;
        document.body.appendChild(modal);
        document.body.style.overflow = 'hidden';
        modal.classList.add('active');
        
        modal.addEventListener('click', (e) => {
          if (e.target === modal) {
            modal.remove();
            document.body.style.overflow = '';
          }
        });
      }
      
      window.openSizeGuide = openSizeGuide;

      // ====== COLOR SWATCH SELECTOR ======
      function selectColorSwatch(element, imageSrc) {
        document.querySelectorAll('.color-swatch').forEach(swatch => {
          swatch.classList.remove('active');
        });
        element.classList.add('active');
        
        // Update main product image
        const mainImage = document.getElementById('mainProductImage');
        if (mainImage) {
          mainImage.src = imageSrc;
        }
        
        // Update thumbnails
        const thumbnails = document.querySelectorAll('.thumbnail');
        if (thumbnails.length > 0) {
          thumbnails[0].src = imageSrc;
        }
      }
      
      window.selectColorSwatch = selectColorSwatch;

      // ====== PRODUCT BADGES ======
      function updateProductBadge(product) {
        const badge = document.getElementById('productBadge');
        if (!badge) return;
        
        const discount = Math.round(((product.originalPrice - product.price) / product.originalPrice) * 100);
        
        // Determine badge type
        if (discount >= 50) {
          badge.textContent = 'Sale';
          badge.className = 'product-badge sale';
          badge.style.display = 'block';
        } else if (product.isNew) {
          badge.textContent = 'New';
          badge.className = 'product-badge new';
          badge.style.display = 'block';
        } else if (product.isBestseller) {
          badge.textContent = 'Bestseller';
          badge.className = 'product-badge bestseller';
          badge.style.display = 'block';
        } else {
          badge.style.display = 'none';
        }
      }

      // ====== STOCK AVAILABILITY ======
      function updateStockIndicator(product) {
        const stockEl = document.getElementById('stockAvailability');
        if (!stockEl) return;
        
        // Mock stock data - in real app, this would come from product data
        const stock = product.stock || Math.floor(Math.random() * 50) + 1;
        
        let stockHtml = '';
        if (stock > 10) {
          stockHtml = `<div class="stock-indicator in-stock"><span class="stock-indicator-icon"></span><span>In Stock</span></div>`;
        } else if (stock > 0) {
          stockHtml = `<div class="stock-indicator low-stock"><span class="stock-indicator-icon"></span><span>Only ${stock} left!</span></div>`;
        } else {
          stockHtml = `<div class="stock-indicator out-of-stock"><span class="stock-indicator-icon"></span><span>Out of Stock</span></div>`;
          // Disable add to cart and buy now
          const addToCartBtn = document.getElementById('addToCartBtn');
          const buyNowBtn = document.getElementById('buyNowBtn');
          if (addToCartBtn) addToCartBtn.disabled = true;
          if (buyNowBtn) buyNowBtn.disabled = true;
        }
        
        stockEl.innerHTML = stockHtml;
      }

      // ====== BUNDLE DEALS ======
      function renderBundleDeals(product) {
        const bundleSection = document.getElementById('bundleSection');
        const bundleItems = document.getElementById('bundleItems');
        if (!bundleSection || !bundleItems) return;
        
        // Mock bundle products
        const bundleProducts = [
          { name: 'Matching Trousers', price: 599, image: '../assets/products/p2.jpg' },
          { name: 'Casual Belt', price: 299, image: '../assets/products/p3.jpg' }
        ];
        
        if (bundleProducts.length === 0) {
          bundleSection.style.display = 'none';
          return;
        }
        
        bundleSection.style.display = 'block';
        
        let totalPrice = product.price;
        bundleItems.innerHTML = `
          <div class="bundle-item">
            <img src="${product.image}" alt="${product.name}" class="bundle-item-image">
            <div class="bundle-item-name">${product.name}</div>
            <div class="bundle-item-price">₹${product.price}</div>
          </div>
          ${bundleProducts.map(bp => {
            totalPrice += bp.price;
            return `
              <div class="bundle-item">
                <img src="${bp.image}" alt="${bp.name}" class="bundle-item-image">
                <div class="bundle-item-name">${bp.name}</div>
                <div class="bundle-item-price">₹${bp.price}</div>
              </div>
            `;
          }).join('')}
        `;
        
        const bundleDiscount = Math.round(totalPrice * 0.1); // 10% discount
        const finalPrice = totalPrice - bundleDiscount;
        
        document.getElementById('bundleSavings').innerHTML = `
          <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
            <span>Total:</span>
            <span>₹${totalPrice}</span>
          </div>
          <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
            <span>Bundle Discount:</span>
            <span style="color: #4caf50;">- ₹${bundleDiscount}</span>
          </div>
          <div style="display: flex; justify-content: space-between; font-size: 1.2rem; font-weight: 700;">
            <span>Final Price:</span>
            <span>₹${finalPrice}</span>
          </div>
        `;
        
        document.getElementById('bundleSaveAmount').textContent = bundleDiscount;
      }
      
      window.addBundleToCart = function() {
        const product = getProductFromURL();
        if (window.CartUtils) {
          window.CartUtils.addItemToCart(product);
        }
        if (window.showToast) {
          showToast('Bundle items added to cart!', 'success', 'Bundle Added');
        }
      };

      // ====== PRODUCT RECOMMENDATIONS ======
      function renderRecommendations(currentProduct) {
        const recommendationsGrid = document.getElementById('recommendationsGrid');
        if (!recommendationsGrid) return;
        
        // Mock recommendations - in real app, this would be based on similar products
        const allProducts = [
          { name: 'Colourblocked Polo T-shirt', price: 593, originalPrice: 1099, brand: 'Allen Solly', image: '../assets/all_products/q1.jpg' },
          { name: 'Pure Cotton Custom Fit Shirt', price: 917, originalPrice: 1799, brand: 'Allen Solly', image: '../assets/all_products/q3.jpg' },
          { name: 'Polo Collar Slim Fit T-shirt', price: 929, originalPrice: 1499, brand: 'Louis Philippe Jeans', image: '../assets/all_products/q4.jpg' },
          { name: 'Pure Cotton Casual Shirt', price: 993, originalPrice: 1949, brand: 'Allen Solly', image: '../assets/all_products/q5.jpg' },
          { name: 'Classic Fit Formal Shirt', price: 849, originalPrice: 1599, brand: 'Louis Philippe Jeans', image: '../assets/all_products/q1.jpg' },
          { name: 'Regular Fit Cotton T-shirt', price: 699, originalPrice: 1299, brand: 'Allen Solly', image: '../assets/all_products/q4.jpg' }
        ];
        
        // Filter out current product and get 4 recommendations
        const recommendations = allProducts
          .filter(p => p.name !== currentProduct.name)
          .slice(0, 4);
        
        recommendationsGrid.innerHTML = recommendations.map(product => {
          const discount = Math.round(((product.originalPrice - product.price) / product.originalPrice) * 100);
          const productUrl = `product-detail.html?name=${encodeURIComponent(product.name)}&price=${product.price}&originalPrice=${product.originalPrice}&image=${encodeURIComponent(product.image)}&brand=${encodeURIComponent(product.brand)}`;
          
          return `
            <div class="recommendation-card" onclick="window.location.href='${productUrl}'">
              <img src="${product.image}" alt="${product.name}" class="recommendation-image">
              <div class="recommendation-info">
                <div class="recommendation-name">${product.name}</div>
                <div class="recommendation-price">₹${product.price}</div>
              </div>
            </div>
          `;
        }).join('');
      }

      // ====== PRICE DROP ALERTS ======
      function openPriceAlert() {
        const product = getProductFromURL();
        const modal = document.createElement('div');
        modal.className = 'price-alert-modal';
        modal.innerHTML = `
          <div class="price-alert-content">
            <h3 style="margin-bottom: 16px; color: var(--text-color, #333);">Set Price Alert</h3>
            <p style="margin-bottom: 16px; color: var(--text-color, #666);">Get notified when the price of <strong>${product.name}</strong> drops below your target price.</p>
            <form class="price-alert-form" onsubmit="event.preventDefault(); setPriceAlert(${product.price});">
              <label style="color: var(--text-color, #333); font-weight: 600;">Target Price (₹)</label>
              <input type="number" class="price-alert-input" id="targetPrice" value="${Math.round(product.price * 0.9)}" min="0" required>
              <div style="display: flex; gap: 12px;">
                <button type="submit" style="flex: 1; padding: 12px; background: #ff6d2e; color: #fff; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">Set Alert</button>
                <button type="button" onclick="this.closest('.price-alert-modal').remove(); document.body.style.overflow = '';" style="flex: 1; padding: 12px; background: transparent; border: 2px solid rgba(0,0,0,0.1); border-radius: 8px; font-weight: 600; cursor: pointer; color: var(--text-color, #333);">Cancel</button>
              </div>
            </form>
          </div>
        `;
        document.body.appendChild(modal);
        document.body.style.overflow = 'hidden';
        modal.classList.add('active');
        
        modal.addEventListener('click', (e) => {
          if (e.target === modal) {
            modal.remove();
            document.body.style.overflow = '';
          }
        });
      }
      
      function setPriceAlert(currentPrice) {
        const targetPrice = parseFloat(document.getElementById('targetPrice').value);
        const product = getProductFromURL();
        
        if (targetPrice >= currentPrice) {
          if (window.showToast) {
            showToast('Target price must be less than current price', 'error', 'Invalid Price');
          }
          return;
        }
        
        // Save price alert
        let alerts = JSON.parse(localStorage.getItem('priceAlerts') || '[]');
        alerts = alerts.filter(a => a.productName !== product.name);
        alerts.push({
          productName: product.name,
          productImage: product.image,
          currentPrice: currentPrice,
          targetPrice: targetPrice,
          setAt: new Date().toISOString()
        });
        localStorage.setItem('priceAlerts', JSON.stringify(alerts));
        
        // Update button
        const alertBtn = document.getElementById('priceAlertBtn');
        if (alertBtn) {
          alertBtn.classList.add('active');
          alertBtn.innerHTML = `
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 12l2 2 4-4"></path>
              <path d="M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9 9 4.03 9 9z"></path>
            </svg>
            Alert Set (₹${targetPrice})
          `;
        }
        
        // Close modal
        document.querySelector('.price-alert-modal')?.remove();
        document.body.style.overflow = '';
        
        if (window.showToast) {
          showToast('Price alert set successfully!', 'success', 'Alert Set');
        }
      }
      
      window.openPriceAlert = openPriceAlert;
      window.setPriceAlert = setPriceAlert;

      // ====== BUY NOW FUNCTIONALITY ======
      function buyNow() {
        const product = getProductFromURL();
        const selectedSize = document.querySelector('.size-btn.active')?.dataset.size || 'L';
        const selectedColor = document.querySelector('.color-swatch.active')?.dataset.color || 'Blue';
        
        // Add to cart
        if (window.CartUtils) {
          window.CartUtils.addItemToCart({
            ...product,
            size: selectedSize,
            color: selectedColor
          });
        }
        
        // Redirect to cart page
        window.location.href = 'cart.html';
      }
      
      window.buyNow = buyNow;

      // ====== PRODUCT Q&A ======
      function toggleQA(element) {
        const answer = element.nextElementSibling;
        element.classList.toggle('active');
        answer.classList.toggle('active');
      }
      
      function submitQuestion() {
        const question = document.getElementById('questionInput').value.trim();
        if (!question) {
          if (window.showToast) {
            showToast('Please enter a question', 'error', 'Question Required');
          }
          return;
        }
        
        let questions = JSON.parse(localStorage.getItem('productQuestions') || '[]');
        questions.push({
          product: getProductFromURL().name,
          question: question,
          date: new Date().toISOString()
        });
        localStorage.setItem('productQuestions', JSON.stringify(questions));
        
        document.getElementById('questionInput').value = '';
        
        if (window.showToast) {
          showToast('Question submitted! We\'ll get back to you soon.', 'success', 'Question Submitted');
        }
      }
      
      // ====== PRODUCT VIDEO ======
      function loadProductVideo(product) {
        const videoSection = document.getElementById('productVideoSection');
        const videoContainer = document.getElementById('productVideoContainer');
        
        const videoUrl = product.videoUrl || null;
        
        if (videoUrl) {
          videoSection.style.display = 'block';
          videoContainer.innerHTML = `<iframe src="${videoUrl}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`;
        } else {
          videoSection.style.display = 'none';
        }
      }
      
      window.toggleQA = toggleQA;
      window.submitQuestion = submitQuestion;

      // Update product data on load
      document.addEventListener('DOMContentLoaded', () => {
        const product = getProductFromURL();
        updateProductBadge(product);
        updateStockIndicator(product);
        renderBundleDeals(product);
        renderRecommendations(product);
        loadProductVideo(product);
      });

      // ====== SOCIAL SHARING ======
      window.shareProduct = function(platform) {
        const product = getProductFromURL();
        const productUrl = window.location.href;
        const productName = product.name;
        const productPrice = `₹${product.price}`;
        const shareText = `Check out ${productName} for just ${productPrice} at V Store!`;
        
        let shareUrl = '';
        
        switch(platform) {
          case 'whatsapp':
            shareUrl = `https://wa.me/?text=${encodeURIComponent(shareText + ' ' + productUrl)}`;
            window.open(shareUrl, '_blank');
            break;
          case 'facebook':
            shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(productUrl)}`;
            window.open(shareUrl, '_blank', 'width=600,height=400');
            break;
          case 'twitter':
            shareUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(shareText)}&url=${encodeURIComponent(productUrl)}`;
            window.open(shareUrl, '_blank', 'width=600,height=400');
            break;
          case 'copy':
            navigator.clipboard.writeText(productUrl).then(() => {
              if (window.showToast) {
                showToast('Product link copied to clipboard!', 'success', 'Link Copied');
              } else {
                alert('Link copied to clipboard!');
              }
            }).catch(() => {
              // Fallback for older browsers
              const textArea = document.createElement('textarea');
              textArea.value = productUrl;
              document.body.appendChild(textArea);
              textArea.select();
              document.execCommand('copy');
              document.body.removeChild(textArea);
              if (window.showToast) {
                showToast('Product link copied to clipboard!', 'success', 'Link Copied');
              } else {
                alert('Link copied to clipboard!');
              }
            });
            break;
        }
      };
    });
  </script>
</body>
</html>

