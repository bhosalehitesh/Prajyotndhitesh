<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Razorpay Test Payment</title>
	<script src="https://checkout.razorpay.com/v1/checkout.js"></script>


    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 40px;
            background: #f5f5f5;
        }

        .box {
            background: white;
            padding: 30px;
            max-width: 450px;
            margin: auto;
            border-radius: 10px;
            box-shadow: 0 0 15px #cccccc;
        }

        button {
            padding: 12px 22px;
            background: #3e66fb;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 18px;
        }

        button:hover {
            background: #264ee5;
        }
    </style>
</head>
<body>

<div class="box">
    <h2>Test Razorpay Payment</h2>

    <label>Order ID (in DB):</label>
    <input id="orderId" type="number" value="1" style="width:100%;padding:10px;margin:10px 0"/>

    <label>Amount:</label>
    <input id="amount" type="number" value="199" style="width:100%;padding:10px;margin:10px 0"/>

    <button onclick="startPayment()">Pay Now</button>
</div>

<script>
async function startPayment() {
    const orderId = document.getElementById("orderId").value;
    const amount = document.getElementById("amount").value;

    // STEP 1 → Call your backend to create Razorpay Order
    const createOrderApi = "http://localhost:8080/payment/create-razorpay-order"; 

    const orderResponse = await fetch(createOrderApi, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({
            orderId: Number(orderId),
            amount: Number(amount)
        })
    }).then(res => res.json());

    console.log("Backend Order Response:", orderResponse);

    if (!orderResponse.razorpayOrderId) {
        alert("Failed to create Razorpay order");
        return;
    }

    // STEP 2 → Open Razorpay Checkout Popup
    const options = {
        key: orderResponse.razorpayKey,
        amount: orderResponse.amount * 100,
        currency: "INR",
        name: "Test Store",
        description: "Razorpay Test Payment",
        order_id: orderResponse.razorpayOrderId,

        handler: function (response) {
            console.log("Payment Success:", response);

            // STEP 3 → Send callback to your backend
            fetch("http://localhost:8080/payment/razorpay-callback", {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({
                    razorpay_order_id: response.razorpay_order_id,
                    razorpay_payment_id: response.razorpay_payment_id,
                    razorpay_signature: response.razorpay_signature
                })
            })
            .then(res => res.json())
            .then(data => {
                console.log("Callback Saved:", data);
                alert("Payment Completed Successfully!\nPayment ID: " + response.razorpay_payment_id);
            });
        },

        theme: {color: "#3399cc"}
    };

    const rzp = new Razorpay(options);
    rzp.open();
}
</script>

</body>
</html>
