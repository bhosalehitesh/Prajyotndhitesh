/**
 * Script to auto-detect IP address and create local API config
 * Run: node scripts/setup-local-ip.js
 * 
 * This creates apiConfig.local.ts with your current IP address
 * This file is gitignored, so it won't affect other team members
 */

const fs = require('fs');
const path = require('path');
const { execSync } = require('child_process');

function getLocalIP() {
  try {
    // Windows
    if (process.platform === 'win32') {
      const output = execSync('ipconfig | findstr /i "IPv4"', { encoding: 'utf-8' });
      const match = output.match(/IPv4[^:]*:\s*(\d+\.\d+\.\d+\.\d+)/);
      if (match && match[1]) {
        return match[1];
      }
    } else {
      // Mac/Linux
      const output = execSync("ifconfig | grep 'inet ' | grep -v '127.0.0.1' | awk '{print $2}' | head -1", { encoding: 'utf-8' });
      const ip = output.trim();
      if (ip) {
        return ip;
      }
    }
  } catch (error) {
    console.error('Error detecting IP:', error.message);
  }
  return null;
}

function createLocalConfig() {
  const ip = getLocalIP();
  
  if (!ip) {
    console.error('‚ùå Could not detect your IP address. Please set it manually.');
    console.log('\nTo create local config manually:');
    console.log('1. Copy Frontend/src/utils/apiConfig.local.ts.example to Frontend/src/utils/apiConfig.local.ts');
    console.log('2. Update the IP address in that file');
    process.exit(1);
  }

  const configPath = path.join(__dirname, '../src/utils/apiConfig.local.ts');
  const configContent = `/**
 * Local API Configuration (Gitignored)
 * 
 * This file is auto-generated by setup-local-ip.js
 * You can manually edit this file if needed.
 * This file is gitignored, so it won't affect other team members.
 */

export const USE_IP_ADDRESS = true; // Using IP address instead of localhost
export const API_BASE_URL_DEV_IP = 'http://${ip}:8080'; // Auto-detected IP address
`;

  try {
    fs.writeFileSync(configPath, configContent, 'utf-8');
    console.log('‚úÖ Local API config created successfully!');
    console.log(`   IP Address: ${ip}`);
    console.log(`   Config file: ${configPath}`);
    console.log('\nüìù Note: This file is gitignored, so it won\'t be committed.');
    console.log('   Other team members will use localhost (ADB reverse) by default.');
  } catch (error) {
    console.error('‚ùå Error creating local config:', error.message);
    process.exit(1);
  }
}

// Run the script
createLocalConfig();

