<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>V Store - Men's Fashion | Home</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css">
  <style>
    #searchModal,
    #cartModal {
      display: none !important;
      visibility: hidden !important;
      opacity: 0 !important;
      height: 0 !important;
      overflow: hidden !important;
    }

    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      background: #fff;
    }

    /* Login/Signup Modal Styles */
    .login-modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(4px);
      z-index: 10000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    .login-modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .login-modal {
      background: var(--card-bg, #fff);
      border-radius: 20px;
      width: 100%;
      max-width: 420px;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      transform: scale(0.9);
      transition: transform 0.3s ease;
    }

    .login-modal-overlay.active .login-modal {
      transform: scale(1);
    }

    .login-modal-close {
      position: absolute;
      top: 16px;
      right: 16px;
      background: rgba(0, 0, 0, 0.05);
      border: none;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 24px;
      color: var(--text-color, #333);
      transition: all 0.2s;
      z-index: 1;
    }

    .login-modal-close:hover {
      background: rgba(0, 0, 0, 0.1);
      transform: rotate(90deg);
    }


    .login-form-container {
      padding: 32px;
    }

    .login-form-container.active {
      display: block !important;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      font-size: 0.9rem;
      color: var(--text-color, #333);
    }

    .form-group input {
      width: 100%;
      padding: 14px 16px;
      border: 2px solid rgba(0, 0, 0, 0.1);
      border-radius: 10px;
      font-size: 1rem;
      background: var(--bg-color, #fff);
      color: var(--text-color, #333);
      transition: all 0.3s;
      box-sizing: border-box;
    }

    .form-group input:focus {
      outline: none;
      border-color: #ff6d2e;
      box-shadow: 0 0 0 3px rgba(255, 109, 46, 0.1);
    }

    body.dark-mode .form-group input {
      border-color: rgba(255, 255, 255, 0.1);
    }

    .form-options {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      font-size: 0.9rem;
    }

    .remember-me {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      color: var(--text-color, #666);
    }

    .remember-me input[type="checkbox"] {
      width: auto;
      cursor: pointer;
    }

    .forgot-password {
      color: #ff6d2e;
      text-decoration: none;
      font-weight: 600;
      transition: color 0.2s;
    }

    .forgot-password:hover {
      color: #e55a1f;
    }

    .login-submit-btn {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, #ff6d2e 0%, #ff8533 100%);
      color: #fff;
      border: none;
      border-radius: 12px;
      font-weight: 700;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 4px 12px rgba(255, 109, 46, 0.3);
      margin-bottom: 20px;
    }

    .login-submit-btn {
      box-shadow: 0 4px 12px rgba(255, 109, 46, 0.3);
    }

    .login-submit-btn:hover {
      background: linear-gradient(135deg, #e55a1f 0%, #ff6d2e 100%) !important;
      box-shadow: 0 6px 16px rgba(255, 109, 46, 0.4);
    }

    .login-back-btn:hover {
      border-color: #ff6d2e !important;
      color: #ff6d2e !important;
      background: rgba(255, 109, 46, 0.05);
    }

    .login-submit-btn:hover {
      background: linear-gradient(135deg, #e55a1f 0%, #ff6d2e 100%);
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(255, 109, 46, 0.4);
    }

    .login-submit-btn:active {
      transform: translateY(0);
    }

    .login-divider {
      text-align: center;
      margin: 24px 0;
      position: relative;
      color: var(--text-color, #999);
      font-size: 0.9rem;
    }

    .login-divider::before {
      content: '';
      position: absolute;
      left: 0;
      top: 50%;
      width: 100%;
      height: 1px;
      background: rgba(0, 0, 0, 0.1);
    }

    body.dark-mode .login-divider::before {
      background: rgba(255, 255, 255, 0.1);
    }

    .login-divider span {
      background: var(--card-bg, #fff);
      padding: 0 16px;
      position: relative;
    }

    .login-social-btn {
      width: 100%;
      padding: 14px;
      background: var(--card-bg, #fff);
      border: 2px solid rgba(0, 0, 0, 0.1);
      border-radius: 10px;
      font-weight: 600;
      font-size: 0.95rem;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      color: var(--text-color, #333);
    }

    body.dark-mode .login-social-btn {
      border-color: rgba(255, 255, 255, 0.1);
    }

    .login-social-btn:hover {
      border-color: #ff6d2e;
      background: rgba(255, 109, 46, 0.05);
    }

    .login-back-btn {
      width: 100%;
      padding: 12px;
      background: transparent;
      border: 2px solid rgba(0, 0, 0, 0.1);
      border-radius: 10px;
      font-weight: 600;
      font-size: 0.95rem;
      cursor: pointer;
      transition: all 0.3s;
      color: var(--text-color, #666);
      margin-top: 12px;
    }

    body.dark-mode .login-back-btn {
      border-color: rgba(255, 255, 255, 0.1);
    }

    .login-back-btn:hover {
      border-color: #ff6d2e;
      color: #ff6d2e;
    }

    @media (max-width: 480px) {
      .login-modal {
        max-width: 100%;
        border-radius: 16px 16px 0 0;
        max-height: 95vh;
      }

      .login-modal-header,
      .login-form-container {
        padding: 24px 20px;
      }
    }

    /* Hide scrollbar for modal */
    .login-modal::-webkit-scrollbar {
      width: 6px;
    }

    .login-modal::-webkit-scrollbar-track {
      background: transparent;
    }

    .login-modal::-webkit-scrollbar-thumb {
      background: rgba(255, 109, 46, 0.3);
      border-radius: 3px;
    }

    .login-modal::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 109, 46, 0.5);
    }

    /* Floating Login Button */
    .floating-login-btn {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%) translateZ(0);
      z-index: 9999;
      background: linear-gradient(135deg, #ff6d2e 0%, #ff8533 100%);
      color: #fff;
      border: none;
      border-radius: 50px;
      padding: 16px 32px;
      font-weight: 700;
      font-size: 1rem;
      cursor: pointer;
      box-shadow: 0 8px 24px rgba(255, 109, 46, 0.4);
      display: flex;
      align-items: center;
      gap: 10px;
      transition: transform 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
      animation: floatPulse 3s ease-in-out infinite;
      will-change: transform, box-shadow;
      pointer-events: auto;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }

    .floating-login-btn:hover {
      background: linear-gradient(135deg, #e55a1f 0%, #ff6d2e 100%);
      transform: translateX(-50%) translateY(-4px) translateZ(0);
      box-shadow: 0 12px 32px rgba(255, 109, 46, 0.5);
    }

    .floating-login-btn:active {
      transform: translateX(-50%) translateY(-2px) translateZ(0);
      transition: transform 0.1s ease;
    }

    .floating-login-btn svg {
      width: 20px;
      height: 20px;
      stroke: currentColor;
    }

    @keyframes floatPulse {
      0%, 100% {
        box-shadow: 0 8px 24px rgba(255, 109, 46, 0.4);
      }
      50% {
        box-shadow: 0 8px 32px rgba(255, 109, 46, 0.6);
      }
    }

    /* Hide floating button when user is logged in or modal is open */
    body.logged-in .floating-login-btn,
    .login-modal-overlay.active ~ .floating-login-btn {
      display: none;
    }

    @media (max-width: 768px) {
      .floating-login-btn {
        bottom: 20px;
        padding: 14px 28px;
        font-size: 0.95rem;
      }
    }

  </style>
    <script>
      // Support URLs like index.html/storeId=20 -> rewrite to index.html?storeId=20
      (function() {
        try {
          var p = window.location.pathname || '';
          if (p.indexOf('index.html/') !== -1) {
            var newHref = window.location.href.replace('/index.html/', '/index.html?');
            // preserve hash
            window.location.replace(newHref);
          }
        } catch (e) {
          // ignore
        }
      })();
    </script>
</head>
<body class="home-page">
  <div class="page-wrapper">
    <!-- Header -->
    <header class="topbar">
      <div class="topbar-inner container">
        <div class="left-group">
          <div class="avatar" aria-hidden="true">
            <a href="index.html" style="text-decoration:none;color:inherit;display:flex;align-items:center;justify-content:center;width:100%;height:100%;"><span>V</span></a>
          </div>
          <div class="divider"></div>
          <nav class="main-nav" aria-label="Main">
            <a href="pages/categories.html" class="nav-item">Categories</a>
            <a href="pages/featured.html" class="nav-item">Featured</a>
            <a href="pages/products.html" class="nav-item">Products</a>
          </nav>
          <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Toggle Menu">☰</button>
        </div>
        <div class="right-group">
          <!-- Dark Mode Toggle Switch -->
          <div class="dark-mode-toggle-container">
            <label class="dark-mode-toggle" for="dark-mode-switch" title="Toggle Dark Mode">
              <input type="checkbox" id="dark-mode-switch" class="toggle-input">
              <span class="toggle-track">
                <svg class="sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="4"></circle>
                  <line x1="12" y1="1" x2="12" y2="3"></line>
                  <line x1="12" y1="21" x2="12" y2="23"></line>
                  <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                  <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                  <line x1="1" y1="12" x2="3" y2="12"></line>
                  <line x1="21" y1="12" x2="23" y2="12"></line>
                  <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                  <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                </svg>
                <svg class="moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                </svg>
                <span class="toggle-indicator"></span>
              </span>
            </label>
          </div>

          <button class="icon-btn" id="searchBtn" title="Search Products">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor">
              <circle cx="11" cy="11" r="6" stroke-width="1.6"></circle>
              <path d="M21 21l-4.35-4.35" stroke-width="1.6" stroke-linecap="round"></path>
            </svg>
          </button>

          <button class="icon-btn" id="wishlistBtn" title="Wishlist" onclick="window.location.href='pages/wishlist.html'">
            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor">
              <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" stroke-width="1.5" stroke-linejoin="round"></path>
            </svg>
            <span class="wishlist-count" id="wishlistCount">0</span>
          </button>
          <button class="icon-btn" id="cartBtn" title="Cart" onclick="window.location.href='pages/cart.html'">
            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor">
              <path d="M6 6h15l-1.5 9h-12z" stroke-width="1.5" stroke-linejoin="round"></path>
              <circle cx="10" cy="20" r="1.4" stroke-width="1.5"></circle>
              <circle cx="18" cy="20" r="1.4" stroke-width="1.5"></circle>
            </svg>
            <span class="cart-count" id="cartCount">0</span>
          </button>
          <!-- Profile Button -->
          <button class="icon-btn" id="profileBtn" title="Profile" onclick="openProfileSidebar()">
            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
          </button>
        </div>
      </div>
    </header>

    <!-- Login/Signup Modal (inline for home page) -->
    <div class="login-modal-overlay" id="loginModalOverlay">
      <div class="login-modal" id="loginModal">
        <!-- Close Button -->
        <button class="login-modal-close" id="loginModalClose" aria-label="Close">
          <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>

        <!-- Phone Number Login Form -->
        <div class="login-form-container" id="loginFormContainer">
          <h2 class="login-title">Welcome Back</h2>
          <p class="login-subtitle">Login or create an account</p>
          <form class="login-form" id="loginPhoneForm">
            <div class="form-group">
              <label for="loginPhone">Phone Number</label>
              <input type="tel" id="loginPhone" placeholder="Enter 10-digit phone number" required pattern="[0-9]{10}" maxlength="10" autocomplete="tel">
            </div>
            <button type="submit" class="login-submit-btn">Get OTP</button>
          </form>
        </div>

        <!-- OTP Verification Form -->
        <div class="login-form-container" id="otpFormContainer" style="display: none;">
          <h2 class="login-title">Verify OTP</h2>
          <p class="login-subtitle" id="otpPhoneDisplay">We have sent a code by SMS to your phone.</p>
          <form class="login-form" id="otpForm">
            <div class="form-group">
              <label for="otpInput">Enter OTP</label>
              <input type="text" id="otpInput" placeholder="Enter OTP" required pattern="[0-9]{6}" maxlength="6" style="text-align: center; font-size: 1.2rem; letter-spacing: 8px; font-weight: 600;">
            </div>
            <button type="submit" class="login-submit-btn" style="background: linear-gradient(135deg, #ff6d2e 0%, #ff8533 100%); margin-bottom: 12px;">Verify and Continue</button>
            <button type="button" class="login-back-btn" id="resendOtpBtn" style="border-color: #ff6d2e; color: #ff6d2e;">Resend OTP</button>
          </form>
        </div>

      </div>
    </div>

    <!-- Floating Login Button -->
    <button class="floating-login-btn" id="floatingLoginBtn" type="button">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
        <circle cx="12" cy="7" r="4"></circle>
      </svg>
      <span>Login / Sign Up</span>
    </button>

    <!-- Profile Sidebar Menu -->
    <div class="profile-sidebar-overlay" id="profileSidebarOverlay"></div>
    <div class="profile-sidebar" id="profileSidebar">
      <div class="profile-sidebar-header">
        <button class="profile-sidebar-close" id="profileSidebarClose" aria-label="Close Menu">
          <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="profile-sidebar-content">
        <div class="profile-sidebar-user">
          <div class="profile-sidebar-avatar">
            <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
          </div>
          <div class="profile-sidebar-info">
            <div class="profile-sidebar-name">Hello User</div>
            <div class="profile-sidebar-phone">+1234567890</div>
          </div>
        </div>
        <div class="profile-sidebar-menu">
          <a href="pages/orders.html" class="profile-sidebar-item" id="sidebarMyOrders">
            <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="1.5">
              <circle cx="9" cy="21" r="1"></circle>
              <circle cx="20" cy="21" r="1"></circle>
              <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
            </svg>
            <span>My Orders</span>
          </a>
          <a href="pages/wishlist.html" class="profile-sidebar-item" id="sidebarWishlist">
            <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
            </svg>
            <span>My Wishlist</span>
          </a>
          <a href="pages/cart.html" class="profile-sidebar-item" id="sidebarCart">
            <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="1.5">
              <circle cx="9" cy="21" r="1"></circle>
              <circle cx="20" cy="21" r="1"></circle>
              <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
            </svg>
            <span>Shopping Cart</span>
          </a>
          <a href="pages/order-tracking.html" class="profile-sidebar-item" id="sidebarTrackOrder">
            <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
              <circle cx="12" cy="10" r="3"></circle>
            </svg>
            <span>Track Order</span>
          </a>
          <div class="profile-sidebar-divider"></div>
          <div class="profile-sidebar-item" id="sidebarLightMode">
            <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="1.5">
              <rect x="1" y="5" width="22" height="14" rx="7" ry="7"></rect>
              <circle cx="8" cy="12" r="3"></circle>
            </svg>
            <span id="sidebarLightModeText">Light Mode</span>
          </div>
          <a href="pages/faq.html" class="profile-sidebar-item" id="sidebarFAQ">
            <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="1.5">
              <circle cx="12" cy="12" r="10"></circle>
              <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
              <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </svg>
            <span>Help & FAQ</span>
          </a>
          <div class="profile-sidebar-item" id="sidebarSignOut" onclick="handleSignOut()" style="cursor: pointer;">
            <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
              <polyline points="16 17 21 12 16 7"></polyline>
              <line x1="21" y1="12" x2="9" y2="12"></line>
            </svg>
            <span>Sign Out</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Mobile Navigation -->
    <nav class="mobile-nav" id="mobileNav">
      <a href="pages/categories.html" class="nav-item">Categories</a>
      <a href="pages/featured.html" class="nav-item">Featured</a>
      <a href="pages/products.html" class="nav-item">Products</a>
      <a href="pages/cart.html" class="nav-item">Cart</a>
      <a href="pages/login.html" class="nav-item">Login</a>
    </nav>

    <!-- Search Modal -->
    <div class="search-modal" id="searchModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
      <div class="search-modal-content" style="background: var(--card-bg, #fff); padding: 30px; border-radius: 12px; width: 90%; max-width: 500px; box-shadow: 0 8px 24px rgba(0,0,0,0.2); position: relative;">
        <h3 style="margin-bottom: 20px; color: var(--text-color, #333); font-size: 1.5rem;">Search Products</h3>
        <div style="position: relative; margin-bottom: 20px;">
          <input type="text" class="search-input" id="searchInput" placeholder="Search for products..." autocomplete="off" style="width: 100%; padding: 12px 40px 12px 16px; border: 2px solid rgba(0,0,0,0.1); border-radius: 8px; font-size: 1rem; background: var(--bg-color, #fff); color: var(--text-color, #333); transition: border-color 0.3s;">
          <button class="search-close" id="searchClose" style="position: absolute; top: 50%; right: 12px; transform: translateY(-50%); background: none; border: none; font-size: 24px; cursor: pointer; color: var(--text-color, #666); padding: 0; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center;">&times;</button>
        </div>
        <!-- Enhanced Search Autocomplete -->
        <div class="search-autocomplete" id="searchAutocomplete"></div>
        <div class="search-results" id="searchResults" style="max-height: 400px; overflow-y: auto;">
          <!-- Search results will appear here -->
        </div>
      </div>
    </div>

    <!-- Banner Carousel Section -->
    <section class="banner-carousel-section">
      <div class="banner-carousel-container">
        <div class="banner-carousel-wrapper">
          <button class="banner-carousel-btn banner-prev" id="bannerPrevBtn" aria-label="Previous banner">&#10094;</button>
          
          <div class="banner-carousel-track" id="bannerCarouselTrack">
            <div class="banner-slide active">
              <img src="assets/Banner/B1.jpg" alt="Banner 1" class="banner-image">
            </div>
            <div class="banner-slide">
              <img src="assets/Banner/b2.jpg" alt="Banner 2" class="banner-image">
            </div>
            <div class="banner-slide">
              <img src="assets/Banner/B3.jpg" alt="Banner 3" class="banner-image">
            </div>
          </div>

          <button class="banner-carousel-btn banner-next" id="bannerNextBtn" aria-label="Next banner">&#10095;</button>
        </div>
        
        <!-- Banner Indicators -->
        <div class="banner-indicators" id="bannerIndicators">
          <span class="banner-indicator active" data-slide="0"></span>
          <span class="banner-indicator" data-slide="1"></span>
          <span class="banner-indicator" data-slide="2"></span>
        </div>
      </div>
    </section>

    <!-- Store Info Section (shown when ?store=slug is present) -->
    <section id="store-info-section" style="display: none; padding: 20px 0; background: var(--bg-color, #fff);">
      <div class="container">
        <div id="store-header" style="text-align: center; margin-bottom: 30px;">
          <img id="store-logo-img" src="" alt="Store Logo" style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; margin: 0 auto 15px; display: none;">
          <h1 id="store-name-display" style="font-size: 2rem; margin-bottom: 10px; color: var(--text-color, #333);"></h1>
          <p id="store-description-display" style="color: var(--text-muted, #666); max-width: 600px; margin: 0 auto;"></p>
        </div>
        <div id="store-categories" style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-bottom: 30px;"></div>
      </div>
    </section>

    <!-- Product Carousel -->
    <section class="carousel-section">
      <div class="carousel-container container">
        <h2 class="carousel-title" id="products-title">Featured Products</h2>
        <div class="carousel">
          <button class="carousel-btn prev" id="prevBtn">&#10094;</button>
          
          <div class="carousel-track" id="carouselTrack">
            <div class="carousel-item" onclick="window.location.href='pages/product-detail.html?name=Men%27s%20Pure%20Cotton%20T-Shirt&price=476&originalPrice=1499&image=../assets/products/p1.jpg&brand=V%20Store'">
              <img src="assets/products/p1.jpg" alt="Product 1">
              <h3>Men's Pure Cotton T-Shirt</h3>
            </div>
            <div class="carousel-item" onclick="window.location.href='pages/product-detail.html?name=Men%27s%20Casual%20T-Shirt&price=499&originalPrice=1099&image=../assets/products/p2.jpg&brand=V%20Store'">
              <img src="assets/products/p2.jpg" alt="Product 2">
              <h3>Men's Casual T-Shirt</h3>
            </div>
            <div class="carousel-item" onclick="window.location.href='pages/product-detail.html?name=Men%27s%20Formal%20Shirt&price=699&originalPrice=1299&image=../assets/products/p3.jpg&brand=V%20Store'">
              <img src="assets/products/p3.jpg" alt="Product 3">
              <h3>Men's Formal Shirt</h3>
            </div>
            <div class="carousel-item" onclick="window.location.href='pages/product-detail.html?name=Men%27s%20Polo%20T-Shirt&price=479&originalPrice=999&image=../assets/products/p4.jpg&brand=V%20Store'">
              <img src="assets/products/p4.jpg" alt="Product 4">
              <h3>Men's Polo T-Shirt</h3>
            </div>
            <div class="carousel-item" onclick="window.location.href='pages/product-detail.html?name=Men%27s%20Cotton%20Shirt&price=619&originalPrice=1199&image=../assets/products/p5.jpg&brand=V%20Store'">
              <img src="assets/products/p5.jpg" alt="Product 5">
              <h3>Men's Cotton Shirt</h3>
            </div>
            <div class="carousel-item" onclick="window.location.href='pages/product-detail.html?name=Men%27s%20Printed%20T-Shirt&price=404&originalPrice=899&image=../assets/products/p6.jpg&brand=V%20Store'">
              <img src="assets/products/p6.jpg" alt="Product 6">
              <h3>Men's Printed T-Shirt</h3>
            </div>
          </div>

          <button class="carousel-btn next" id="nextBtn">&#10095;</button>
        </div>
      </div>
    </section>

    <!-- Trending Categories -->
    <section class="trending-section">
      <div class="container">
        <h2 class="section-title">Trending Categories</h2>
        <div class="trending-grid">
          <div class="category-card">
            <img src="assets/products/cs.jpg" alt="Casual Wear" />
            <p>Casual Wear</p>
          </div>
          <div class="category-card">
            <img src="assets/products/GZ.jpg" alt="GenZ Wear" />
            <p>GenZ Wear</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Biggest Deals -->
    <section class="biggest-deals">
      <div class="container">
        <h2 class="section-title">BIGGEST DEALS ON TOP DRIPS</h2>
        <div class="deals-grid">
          <div class="deal-card">
            <div class="image-wrapper">
              <img src="assets/genz/ts.webp" alt="Oversized Tees">
              <div class="overlay">
                <h3>OVERSIZED TEES</h3>
                <p class="price">STARTING ₹199</p>
              </div>
            </div>
          </div>

          <div class="deal-card">
            <div class="image-wrapper">
              <img src="assets/genz/hd.webp" alt="Hoodies">
              <div class="overlay">
                <h3>HOODIES</h3>
                <p class="price">STARTING ₹299</p>
              </div>
            </div>
          </div>

          <div class="deal-card">
            <div class="image-wrapper">
              <img src="assets/genz/ls.webp" alt="Lowers">
              <div class="overlay">
                <h3>LOWERS</h3>
                <p class="price">STARTING ₹299</p>
              </div>
            </div>
          </div>

          <div class="deal-card">
            <div class="image-wrapper">
              <img src="assets/genz/Bg.jpg" alt="Baggy Jeans">
              <div class="overlay">
                <h3>BAGGY JEANS</h3>
                <p class="price">STARTING ₹399</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Features -->
    <section class="features-section">
      <div class="container features-grid">
        <div class="feature-item">
          <img src="assets/secure-payment.png" alt="Secure Payments" />
          <p>Secure Payments</p>
        </div>
        <div class="feature-item">
          <img src="assets/service.png" alt="Assured Quality" />
          <p>Assured Quality</p>
        </div>
        <div class="feature-item">
          <img src="assets/Made-In-India-PNG-Image.png" alt="Made In India" />
          <p>Made In India</p>
        </div>
        <div class="feature-item">
          <img src="assets/delivery-truck.png" alt="Timely Delivery" />
          <p>Timely Delivery</p>
        </div>
      </div>
    </section>

    <!-- Flash Sale Banner -->
    <section class="flash-sale-section" style="padding: 24px 0;">
      <div class="container">
        <div class="flash-sale-banner">
          <div class="flash-sale-content">
            <div class="flash-sale-title">⚡ Flash Sale - Up to 70% OFF!</div>
            <div class="flash-sale-subtitle">Limited time offer. Hurry up!</div>
          </div>
          <div class="flash-sale-timer" id="flashSaleTimer">
            <div class="timer-item">
              <span class="timer-value" id="hours">00</span>
              <span class="timer-label">Hours</span>
            </div>
            <div class="timer-item">
              <span class="timer-value" id="minutes">00</span>
              <span class="timer-label">Minutes</span>
            </div>
            <div class="timer-item">
              <span class="timer-value" id="seconds">00</span>
              <span class="timer-label">Seconds</span>
            </div>
          </div>
          <button class="flash-sale-button" onclick="window.location.href='pages/products.html'">Shop Now</button>
        </div>
      </div>
    </section>

    <!-- Customer Testimonials -->
    <section class="testimonials-section">
      <div class="container">
        <h2 class="testimonials-title">What Our Customers Say</h2>
        <div class="testimonials-grid">
          <div class="testimonial-card">
            <div class="testimonial-rating">
              <span style="color: #ffc107;">★★★★★</span>
            </div>
            <div class="testimonial-text">
              "Excellent quality products and fast delivery! The fit was perfect and the material is very comfortable. Highly recommended!"
            </div>
            <div class="testimonial-author">
              <div class="testimonial-avatar">RK</div>
              <div class="testimonial-info">
                <div class="testimonial-name">Rajesh Kumar</div>
                <div class="testimonial-role">Verified Buyer</div>
              </div>
            </div>
          </div>
          <div class="testimonial-card">
            <div class="testimonial-rating">
              <span style="color: #ffc107;">★★★★★</span>
            </div>
            <div class="testimonial-text">
              "Great shopping experience! The website is easy to navigate and the customer service is outstanding. Will definitely shop again!"
            </div>
            <div class="testimonial-author">
              <div class="testimonial-avatar">AM</div>
              <div class="testimonial-info">
                <div class="testimonial-name">Amit Mishra</div>
                <div class="testimonial-role">Verified Buyer</div>
              </div>
            </div>
          </div>
          <div class="testimonial-card">
            <div class="testimonial-rating">
              <span style="color: #ffc107;">★★★★☆</span>
            </div>
            <div class="testimonial-text">
              "Good quality products at reasonable prices. The delivery was on time and packaging was excellent. Satisfied with my purchase!"
            </div>
            <div class="testimonial-author">
              <div class="testimonial-avatar">SP</div>
              <div class="testimonial-info">
                <div class="testimonial-name">Suresh Patel</div>
                <div class="testimonial-role">Verified Buyer</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Newsletter Subscription -->
    <section class="newsletter-section">
      <div class="container">
        <h2 class="newsletter-title">Subscribe to Our Newsletter</h2>
        <p class="newsletter-subtitle">Get exclusive offers, new arrivals, and fashion tips delivered to your inbox</p>
        <form class="newsletter-form" onsubmit="event.preventDefault(); subscribeNewsletter();">
          <input type="email" class="newsletter-input" id="newsletterEmail" placeholder="Enter your email address" required>
          <button type="submit" class="newsletter-button">Subscribe</button>
        </form>
      </div>
    </section>

    <!-- Footer -->
    <footer class="site-footer">
      <div class="footer-container container">
        <div class="footer-column contact-info">
          <div class="footer-avatar">V</div>
          <div class="address">
            <p><strong>Shraddha Garden, Gawade Colony</strong></p>
            <p>Chinchwad, Maharashtra, 411019</p>
          </div>
          <div class="phone">
            <p><strong>Talk to us</strong></p>
            <p><a href="tel:+917588933972">+91 7588933972</a></p>
          </div>
        </div>

        <div class="footer-column">
          <h4>Help</h4>
          <ul>
            <li><a href="pages/faq.html">FAQ</a></li>
            <li><a href="#">Store policies</a></li>
            <li><a href="#">Track your Orders</a></li>
            <li><a href="#">Return Policy</a></li>
            <li><a href="#">Privacy Policy</a></li>
          </ul>
        </div>

        <div class="footer-column">
          <h4>Shop</h4>
          <ul>
            <li><a href="#">Mens all wear</a></li>
          </ul>
        </div>
      </div>

      <div class="footer-bottom container">
        <div class="payment-info">
          <span>We accept</span>
          <span class="icon">&#128179;</span>
          <span>Cash on Delivery</span>
        </div>
        <div class="powered-by">
          <span>Built with</span>
          <img src="assets/SmartBiz.png" alt="Smartbiz by Sakhi" class="smartbiz-logo" />
        </div>
      </div>
    </footer>
  </div>

  <!-- API Integration - Must load before app.js -->
  <script src="js/config.js"></script>
  <script src="js/api.js"></script>
  <script src="js/app.js"></script>
  <script>
    // ====== IMMEDIATE LOGIN MODAL HANDLERS - RUNS FIRST ======
    (function() {
      'use strict';
      
      console.log('Login modal handlers initialized');
      
      // Use event delegation - works even if elements don't exist yet
      document.addEventListener('click', function(e) {
        // Close button - check if clicked element or any parent is the close button
        // This handles clicks on the button itself, SVG, or any child elements
        let closeBtn = null;
        
        // Check if the clicked element is the close button
        if (e.target.id === 'loginModalClose') {
          closeBtn = e.target;
        }
        // Check if clicked element is inside the close button (like SVG)
        else if (e.target.closest('#loginModalClose')) {
          closeBtn = e.target.closest('#loginModalClose');
        }
        // Check parent element
        else if (e.target.parentElement && e.target.parentElement.id === 'loginModalClose') {
          closeBtn = e.target.parentElement;
        }
        // Check if parent's parent is the close button (for nested SVG elements)
        else if (e.target.parentElement && e.target.parentElement.parentElement && 
                 e.target.parentElement.parentElement.id === 'loginModalClose') {
          closeBtn = e.target.parentElement.parentElement;
        }
        
        if (closeBtn) {
          console.log('Close button clicked!', e.target);
          e.preventDefault();
          e.stopPropagation();
          e.stopImmediatePropagation();
          
          // Force close the modal
          const overlay = document.getElementById('loginModalOverlay');
          if (overlay) {
            // Remove all active classes and styles
            overlay.classList.remove('active');
            overlay.style.cssText = 'display: none !important; visibility: hidden !important; opacity: 0 !important;';
            document.body.style.overflow = '';
            
            // Reset forms
            const otpContainer = document.getElementById('otpFormContainer');
            const loginContainer = document.getElementById('loginFormContainer');
            if (otpContainer) {
              otpContainer.style.display = 'none';
              otpContainer.style.visibility = 'hidden';
              otpContainer.classList.remove('active');
            }
            if (loginContainer) {
              loginContainer.style.display = 'block';
              loginContainer.style.visibility = 'visible';
              loginContainer.classList.add('active');
            }
            
            // Clear inputs
            const phoneInput = document.getElementById('loginPhone');
            const otpInput = document.getElementById('otpInput');
            if (phoneInput) phoneInput.value = '';
            if (otpInput) otpInput.value = '';
            
            // Clear any timers
            if (window.otpTimer) {
              clearInterval(window.otpTimer);
              window.otpTimer = null;
            }
          }
          
          // Also call function if available
          if (typeof window.closeLoginModal === 'function') {
            try {
              window.closeLoginModal();
            } catch(err) {
              console.error('Error calling closeLoginModal:', err);
            }
          }
          return false;
        }
        
        // Overlay click - only close if clicking directly on overlay, not on modal content
        if (e.target.id === 'loginModalOverlay' || 
            (e.target.classList && e.target.classList.contains('login-modal-overlay'))) {
          console.log('Overlay clicked!');
          e.preventDefault();
          e.stopPropagation();
          e.stopImmediatePropagation();
          
          const overlay = document.getElementById('loginModalOverlay');
          if (overlay) {
            overlay.classList.remove('active');
            overlay.style.cssText = 'display: none !important; visibility: hidden !important; opacity: 0 !important;';
            document.body.style.overflow = '';
          }
          
          if (typeof window.closeLoginModal === 'function') {
            try {
              window.closeLoginModal();
            } catch(err) {
              console.error('Error calling closeLoginModal:', err);
            }
          }
          return false;
        }
      });
      
      // Form submissions
      document.addEventListener('submit', function(e) {
        // Phone form
        if (e.target.id === 'loginPhoneForm') {
          console.log('Phone form submitted!');
          e.preventDefault();
          e.stopPropagation();
          if (typeof window.handlePhoneLogin === 'function') {
            try {
              window.handlePhoneLogin(e);
            } catch(err) {
              console.error('Login error:', err);
              alert('Login error. Please try again.');
            }
          } else {
            alert('Login not available. Please refresh.');
          }
          return false;
        }
        
        // OTP form
        if (e.target.id === 'otpForm') {
          console.log('OTP form submitted!');
          e.preventDefault();
          e.stopPropagation();
          if (typeof window.handleOTPVerification === 'function') {
            try {
              window.handleOTPVerification(e);
            } catch(err) {
              console.error('OTP error:', err);
              alert('OTP verification error. Please try again.');
            }
          } else {
            alert('OTP verification not available. Please refresh.');
          }
          return false;
        }
      });
      
      // Resend button
      document.addEventListener('click', function(e) {
        if (e.target.closest('#resendOtpBtn') || (e.target.closest('.login-back-btn') && e.target.closest('.login-back-btn').textContent.includes('Resend'))) {
          e.preventDefault();
          e.stopPropagation();
          if (typeof window.resendOTP === 'function') {
            try {
              window.resendOTP();
            } catch(err) {
              console.error('Resend error:', err);
              alert('Resend error. Please try again.');
            }
          } else {
            alert('Resend not available. Please refresh.');
          }
          return false;
        }
      });
      
      // Close on Escape key - add to immediate handlers
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' || e.keyCode === 27) {
          const overlay = document.getElementById('loginModalOverlay');
          if (overlay && (overlay.classList.contains('active') || overlay.style.display === 'flex')) {
            console.log('Escape key pressed - closing modal');
            e.preventDefault();
            e.stopPropagation();
            
            overlay.classList.remove('active');
            overlay.style.cssText = 'display: none !important; visibility: hidden !important; opacity: 0 !important;';
            document.body.style.overflow = '';
            
            // Reset forms
            const otpContainer = document.getElementById('otpFormContainer');
            const loginContainer = document.getElementById('loginFormContainer');
            if (otpContainer) {
              otpContainer.style.display = 'none';
              otpContainer.style.visibility = 'hidden';
            }
            if (loginContainer) {
              loginContainer.style.display = 'block';
              loginContainer.style.visibility = 'visible';
            }
            
            // Clear inputs
            const phoneInput = document.getElementById('loginPhone');
            const otpInput = document.getElementById('otpInput');
            if (phoneInput) phoneInput.value = '';
            if (otpInput) otpInput.value = '';
            
            if (typeof window.closeLoginModal === 'function') {
              try {
                window.closeLoginModal();
              } catch(err) {
                console.error('Error calling closeLoginModal:', err);
              }
            }
          }
        }
      }, true); // Use capture phase for early handling
    })();
  </script>
  <script>
    // Login/Signup Modal Functions - Ultra-optimized for instant response
    let loginModalOverlay, loginModal, loginFormContainer;
    
    // Cache modal elements immediately when script loads (synchronous)
    // Modal is in the HTML before this script, so it should be available
    (function cacheModalElements() {
      loginModalOverlay = document.getElementById('loginModalOverlay');
      loginModal = document.getElementById('loginModal');
      loginFormContainer = document.getElementById('loginFormContainer');
    })();

    // Re-cache on DOM ready if not found yet
    if (!loginModalOverlay) {
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
          loginModalOverlay = document.getElementById('loginModalOverlay');
          loginModal = document.getElementById('loginModal');
          loginFormContainer = document.getElementById('loginFormContainer');
        });
      } else {
        loginModalOverlay = document.getElementById('loginModalOverlay');
        loginModal = document.getElementById('loginModal');
        loginFormContainer = document.getElementById('loginFormContainer');
      }
    }

    function openLoginModal(e) {
      // Prevent default behavior and stop propagation immediately
      if (e) {
        e.preventDefault();
        e.stopPropagation();
        e.stopImmediatePropagation();
      }
      
      // Get element directly if not cached (no function calls, just direct access)
      const overlay = loginModalOverlay || document.getElementById('loginModalOverlay');
      
      if (overlay) {
        // Cache it for next time
        loginModalOverlay = overlay;
        
        // Open immediately with no delays - set all styles synchronously
        overlay.style.cssText = 'display: flex !important; opacity: 1 !important; visibility: visible !important;';
        overlay.classList.add('active');
        document.body.style.overflow = 'hidden';
      } else {
        console.error('Login modal not found');
      }
    }
    
    // Make it globally accessible as fallback
    window.openLoginModal = openLoginModal;

    function closeLoginModal() {
      // Get overlay directly if not cached
      const overlay = loginModalOverlay || document.getElementById('loginModalOverlay');
      
      if (overlay) {
        // Cache it
        loginModalOverlay = overlay;
        
        // Fully hide the modal with !important to override any conflicting styles
        overlay.classList.remove('active');
        overlay.style.cssText = 'display: none !important; visibility: hidden !important; opacity: 0 !important;';
        document.body.style.overflow = '';
        
        // Reset forms - show phone form, hide OTP form
        const otpFormContainer = document.getElementById('otpFormContainer');
        if (otpFormContainer) {
          otpFormContainer.style.display = 'none';
          otpFormContainer.style.visibility = 'hidden';
          otpFormContainer.classList.remove('active');
        }
        
        if (loginFormContainer) {
          loginFormContainer.style.display = 'block';
          loginFormContainer.style.visibility = 'visible';
          loginFormContainer.classList.add('active');
        }
        
        // Clear inputs
        const phoneInput = document.getElementById('loginPhone');
        const otpInput = document.getElementById('otpInput');
        if (phoneInput) phoneInput.value = '';
        if (otpInput) otpInput.value = '';
        
        // Clear timer
        if (otpTimer) {
          clearInterval(otpTimer);
          otpTimer = null;
        }
        
        // Reset resend button
        const resendBtn = document.querySelector('.login-back-btn');
        if (resendBtn) {
          resendBtn.textContent = 'Resend OTP';
          resendBtn.disabled = false;
          resendBtn.style.opacity = '1';
          resendBtn.style.cursor = 'pointer';
        }
        
        console.log('Modal closed via closeLoginModal()');
      } else {
        console.warn('Login modal overlay not found');
      }
    }

    // ====== USER AUTHENTICATION API ======
    // Auto-detect backend URL based on current host
    // If frontend is on 192.168.1.25:3000, backend should be on 192.168.1.25:8080
    const getBackendUrl = () => {
      const hostname = window.location.hostname;
      const protocol = window.location.protocol;
      
      // If running on localhost/127.0.0.1, use localhost for backend
      if (hostname === 'localhost' || hostname === '127.0.0.1') {
        return 'http://localhost:8080/api';
      }
      
      // Otherwise, use the same hostname with port 8080
      return `${protocol}//${hostname}:8080/api`;
    };
    
    const API_BASE = getBackendUrl();
    console.log('API Base URL:', API_BASE);
    
    // Helper function to handle fetch errors
    async function handleApiError(error, defaultMessage) {
      if (error.name === 'TypeError' && error.message.includes('fetch')) {
        // Network error - backend not reachable
        const backendUrl = API_BASE.replace('/api', '');
        return new Error(
          'Cannot connect to backend server. Please ensure:\n' +
          `1. Backend server is running on ${backendUrl}\n` +
          '2. CORS is properly configured for your frontend origin\n' +
          '3. No firewall is blocking the connection'
        );
      }
      return error.message ? error : new Error(defaultMessage);
    }
    
    const UserAPI = {
      sendOtp: async (phone) => {
        try {
          const response = await fetch(`${API_BASE}/user/send-otp`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ phone })
          });
          
          if (!response.ok) {
            const error = await response.json().catch(() => ({ 
              message: `Server error: ${response.status} ${response.statusText}` 
            }));
            throw new Error(error.message || `HTTP error! status: ${response.status}`);
          }
          
          return response.json();
        } catch (error) {
          const handledError = await handleApiError(error, 'Failed to send OTP');
          throw handledError;
        }
      },
      verifyOtp: async (phone, code) => {
        try {
          const response = await fetch(`${API_BASE}/user/verify-otp`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ phone, code })
          });
          
          if (!response.ok) {
            const error = await response.json().catch(() => ({ 
              message: `Server error: ${response.status} ${response.statusText}` 
            }));
            throw new Error(error.message || `HTTP error! status: ${response.status}`);
          }
          
          return response.json();
        } catch (error) {
          const handledError = await handleApiError(error, 'Invalid OTP');
          throw handledError;
        }
      }
    };

    let currentPhoneNumber = '';
    let generatedOTP = '';
    let otpTimer = null;

    async function handlePhoneLogin(e) {
      e.preventDefault();
      
      const phoneInput = document.getElementById('loginPhone');
      if (!phoneInput) {
        console.error('Phone input not found');
        if (window.showToast) {
          showToast('Error: Phone input field not found. Please refresh the page.', 'error', 'Error');
        } else {
          alert('Error: Phone input field not found. Please refresh the page.');
        }
        return;
      }
      
      const phone = phoneInput.value.replace(/\D/g, '');
      
      if (phone.length !== 10) {
        if (window.showToast) {
          showToast('Please enter a valid 10-digit phone number', 'error', 'Invalid Phone');
        } else {
          alert('Please enter a valid 10-digit phone number');
        }
        return;
      }

      // Show loading state
      const submitBtn = phoneInput.closest('form')?.querySelector('button[type="submit"]');
      const originalText = submitBtn?.textContent || 'Get OTP';
      if (submitBtn) {
        submitBtn.disabled = true;
        submitBtn.textContent = 'Sending...';
      }

      try {
        // Send OTP via backend API
        const response = await UserAPI.sendOtp(phone);
        currentPhoneNumber = phone;
        localStorage.setItem('pendingPhone', phone);
        
        // Show OTP in console for testing (if backend returns it)
        if (response.otp) {
          console.log('OTP sent to', phone, ':', response.otp);
        }
        
        // Show OTP form
        if (loginFormContainer) {
          loginFormContainer.style.display = 'none';
          loginFormContainer.classList.remove('active');
        }
        
        const otpFormContainer = document.getElementById('otpFormContainer');
        if (otpFormContainer) {
          otpFormContainer.style.display = 'block';
          otpFormContainer.style.visibility = 'visible';
          otpFormContainer.style.opacity = '1';
          otpFormContainer.classList.add('active');
        } else {
          console.error('OTP form container not found');
          if (window.showToast) {
            showToast('Error: OTP form not found. Please refresh the page.', 'error', 'Error');
          } else {
            alert('Error: OTP form not found. Please refresh the page.');
          }
          return;
        }
        
        // Display masked phone number
        const maskedPhone = `+91*****${phone.slice(-4)}`;
        const otpPhoneDisplay = document.getElementById('otpPhoneDisplay');
        if (otpPhoneDisplay) {
          otpPhoneDisplay.textContent = `We have sent a code by sms to ${maskedPhone}.`;
        }
        
        // Focus on OTP input immediately (no delay)
        const otpInput = document.getElementById('otpInput');
        if (otpInput) {
          otpInput.value = ''; // Clear any previous value
          otpInput.focus();
        }
        
        // Show success message
        const message = response.otp ? 
          `OTP sent! Your OTP is: ${response.otp}` : 
          `OTP sent to ${maskedPhone}`;
        if (window.showToast) {
          showToast(message, 'success', 'OTP Sent');
        } else {
          alert(message);
        }
        
        // Start resend timer (60 seconds)
        startOTPTimer();
      } catch (error) {
        console.error('Failed to send OTP:', error);
        const errorMessage = error.message || 'Failed to send OTP. Please try again.';
        
        // Show error in both toast and alert for network errors
        if (errorMessage.includes('Cannot connect to backend')) {
          alert(errorMessage);
        }
        
        if (window.showToast) {
          showToast(
            errorMessage.includes('Cannot connect') ? 
              'Backend server not reachable. Check console for details.' : 
              errorMessage, 
            'error', 
            'Error'
          );
        } else {
          alert(errorMessage);
        }
      } finally {
        if (submitBtn) {
          submitBtn.disabled = false;
          submitBtn.textContent = originalText;
        }
      }
    }

    async function handleOTPVerification(e) {
      e.preventDefault();
      const enteredOTP = document.getElementById('otpInput').value.trim();
      const phone = currentPhoneNumber || localStorage.getItem('pendingPhone');
      
      if (!enteredOTP || enteredOTP.length !== 6) {
        if (window.showToast) {
          showToast('Please enter complete 6-digit OTP', 'error', 'Invalid OTP');
        } else {
          alert('Please enter complete 6-digit OTP');
        }
        return;
      }
      
      if (!phone) {
        if (window.showToast) {
          showToast('Phone number not found. Please start over.', 'error', 'Error');
        } else {
          alert('Phone number not found. Please start over.');
        }
        return;
      }

      // Show loading state
      const submitBtn = document.getElementById('verifyOtpBtn') || e.target.querySelector('button[type="submit"]');
      const originalText = submitBtn?.textContent || 'Verify OTP';
      if (submitBtn) {
        submitBtn.disabled = true;
        submitBtn.textContent = 'Verifying...';
      }

      try {
        // Verify OTP via backend API
        const response = await UserAPI.verifyOtp(phone, enteredOTP);
        
        // Backend returns: {token, userId, fullName, phone}
        const currentUser = {
          id: response.userId,
          userId: response.userId,
          name: response.fullName || `User ${phone.slice(-4)}`,
          fullName: response.fullName || `User ${phone.slice(-4)}`,
          phone: response.phone || phone,
          token: response.token
        };
        
        // Store user data
        localStorage.setItem('currentUser', JSON.stringify(currentUser));
        localStorage.setItem('rememberUser', 'true');
        
        // Clear OTP data
        localStorage.removeItem('pendingOTP');
        localStorage.removeItem('pendingPhone');
        currentPhoneNumber = '';
        
        // Clear timer
        if (otpTimer) {
          clearInterval(otpTimer);
          otpTimer = null;
        }
        
        // Show success message
        if (window.showToast) {
          showToast('Login successful!', 'success', 'Welcome Back');
        }
        
        // Close modal
        closeLoginModal();
        
        // Update UI
        updateFloatingButton();
        if (window.updateProfileSidebar) {
          updateProfileSidebar();
        }
        
        // Refresh page to update all UI elements
        setTimeout(() => {
          window.location.reload();
        }, 500);
      } catch (error) {
        console.error('OTP verification failed:', error);
        const errorMessage = error.message || 'Invalid OTP. Please try again.';
        
        // Show error in both toast and alert for network errors
        if (errorMessage.includes('Cannot connect to backend')) {
          alert(errorMessage);
        }
        
        if (window.showToast) {
          showToast(
            errorMessage.includes('Cannot connect') ? 
              'Backend server not reachable. Check console for details.' : 
              errorMessage, 
            'error', 
            'Verification Failed'
          );
        } else {
          alert(errorMessage);
        }
        const otpInput = document.getElementById('otpInput');
        if (otpInput) {
          otpInput.value = '';
          otpInput.focus();
        }
      } finally {
        if (submitBtn) {
          submitBtn.disabled = false;
          submitBtn.textContent = originalText;
        }
      }
    }

    async function resendOTP() {
      if (!currentPhoneNumber) {
        currentPhoneNumber = localStorage.getItem('pendingPhone');
      }
      
      if (!currentPhoneNumber) {
        if (window.showToast) {
          showToast('Phone number not found. Please start over.', 'error', 'Error');
        } else {
          alert('Phone number not found. Please start over.');
        }
        return;
      }

      // Show loading state
      const resendBtn = document.getElementById('resendOtpBtn') || document.querySelector('.login-back-btn');
      const originalText = resendBtn?.textContent || 'Resend OTP';
      if (resendBtn) {
        resendBtn.disabled = true;
        resendBtn.textContent = 'Sending...';
      }

      try {
        // Resend OTP via backend API
        const response = await UserAPI.sendOtp(currentPhoneNumber);
        
        // Show OTP in console for testing (if backend returns it)
        if (response.otp) {
          console.log('OTP resent to', currentPhoneNumber, ':', response.otp);
        }
        
        // Reset timer
        if (otpTimer) {
          clearInterval(otpTimer);
        }
        startOTPTimer();
        
        const maskedPhone = `+91*****${currentPhoneNumber.slice(-4)}`;
        const message = response.otp ? 
          `OTP resent! Your OTP is: ${response.otp}` : 
          `OTP resent to ${maskedPhone}`;
        if (window.showToast) {
          showToast(message, 'success', 'OTP Resent');
        } else {
          alert(message);
        }
        
        const otpInput = document.getElementById('otpInput');
        if (otpInput) {
          otpInput.value = '';
          otpInput.focus();
        }
      } catch (error) {
        console.error('Failed to resend OTP:', error);
        const errorMessage = error.message || 'Failed to resend OTP. Please try again.';
        
        // Show error in both toast and alert for network errors
        if (errorMessage.includes('Cannot connect to backend')) {
          alert(errorMessage);
        }
        
        if (window.showToast) {
          showToast(
            errorMessage.includes('Cannot connect') ? 
              'Backend server not reachable. Check console for details.' : 
              errorMessage, 
            'error', 
            'Error'
          );
        } else {
          alert(errorMessage);
        }
      } finally {
        if (resendBtn) {
          resendBtn.disabled = false;
          resendBtn.textContent = originalText;
        }
      }
    }

    function startOTPTimer() {
      let seconds = 60;
      const resendBtn = document.querySelector('.login-back-btn');
      
      if (resendBtn) {
        resendBtn.disabled = true;
        resendBtn.style.opacity = '0.6';
        resendBtn.style.cursor = 'not-allowed';
      }
      
      otpTimer = setInterval(() => {
        seconds--;
        if (resendBtn) {
          if (seconds > 0) {
            resendBtn.textContent = `Resend OTP (${seconds}s)`;
          } else {
            resendBtn.textContent = 'Resend OTP';
            resendBtn.disabled = false;
            resendBtn.style.opacity = '1';
            resendBtn.style.cursor = 'pointer';
            clearInterval(otpTimer);
            otpTimer = null;
          }
        }
      }, 1000);
    }

    // Format phone number and OTP input
    function setupInputFormatters() {
      const phoneInput = document.getElementById('loginPhone');
      if (phoneInput && !phoneInput.dataset.formatted) {
        phoneInput.dataset.formatted = 'true'; // Prevent duplicate listeners
        phoneInput.addEventListener('input', (e) => {
          e.target.value = e.target.value.replace(/\D/g, '').slice(0, 10);
        });
      }
      
      const otpInput = document.getElementById('otpInput');
      if (otpInput && !otpInput.dataset.formatted) {
        otpInput.dataset.formatted = 'true'; // Prevent duplicate listeners
        otpInput.addEventListener('input', (e) => {
          e.target.value = e.target.value.replace(/\D/g, '').slice(0, 6);
        });
      }
    }
    
    // Setup input formatters - optimized
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', setupInputFormatters);
    } else {
      setupInputFormatters();
    }
    
    // Retry once after a short delay (only if not already set up)
    setTimeout(setupInputFormatters, 50);


    // Setup ALL login modal handlers - COMPLETE VERSION
    function setupAllLoginHandlers() {
      const loginModalClose = document.getElementById('loginModalClose');
      const loginPhoneForm = document.getElementById('loginPhoneForm');
      const otpForm = document.getElementById('otpForm');
      const loginModalOverlay = document.getElementById('loginModalOverlay');
      const resendBtn = document.getElementById('resendOtpBtn') || document.querySelector('.login-back-btn');
      
      // Skip if already initialized
      if (loginModalOverlay && loginModalOverlay.dataset.allHandlersSet) {
        return;
      }
      
      // Close button - use both onclick and addEventListener for maximum compatibility
      if (loginModalClose) {
        // Remove any existing handlers first
        loginModalClose.onclick = null;
        loginModalClose.removeEventListener('click', closeLoginModal);
        
        // Add new handler
        const closeHandler = function(e) {
          e.preventDefault();
          e.stopPropagation();
          e.stopImmediatePropagation();
          
          console.log('Close button clicked (direct handler)');
          
          // Force close
          if (loginModalOverlay) {
            loginModalOverlay.classList.remove('active');
            loginModalOverlay.style.cssText = 'display: none !important; visibility: hidden !important; opacity: 0 !important;';
            document.body.style.overflow = '';
            
            // Reset forms
            const otpContainer = document.getElementById('otpFormContainer');
            const loginContainer = document.getElementById('loginFormContainer');
            if (otpContainer) {
              otpContainer.style.display = 'none';
              otpContainer.style.visibility = 'hidden';
            }
            if (loginContainer) {
              loginContainer.style.display = 'block';
              loginContainer.style.visibility = 'visible';
            }
            
            // Clear inputs
            const phoneInput = document.getElementById('loginPhone');
            const otpInput = document.getElementById('otpInput');
            if (phoneInput) phoneInput.value = '';
            if (otpInput) otpInput.value = '';
          }
          
          if (typeof closeLoginModal === 'function') {
            try {
              closeLoginModal();
            } catch(err) {
              console.error('Error in closeLoginModal:', err);
            }
          }
        };
        
        loginModalClose.onclick = closeHandler;
        loginModalClose.addEventListener('click', closeHandler, true); // Use capture phase
      }
      
      // Overlay click
      if (loginModalOverlay) {
        loginModalOverlay.onclick = function(e) {
          if (e.target === loginModalOverlay) {
            e.preventDefault();
            e.stopPropagation();
            if (typeof closeLoginModal === 'function') {
              closeLoginModal();
            } else {
              loginModalOverlay.classList.remove('active');
              loginModalOverlay.style.display = 'none';
              document.body.style.overflow = '';
            }
          }
        };
      }
      
      // Phone form
      if (loginPhoneForm) {
        loginPhoneForm.onsubmit = function(e) {
          e.preventDefault();
          e.stopPropagation();
          if (typeof handlePhoneLogin === 'function') {
            try {
              handlePhoneLogin(e);
            } catch(err) {
              console.error('Login error:', err);
              alert('Login error. Please try again.');
            }
          } else {
            alert('Login not available. Please refresh.');
          }
        };
      }
      
      // OTP form
      if (otpForm) {
        otpForm.onsubmit = function(e) {
          e.preventDefault();
          e.stopPropagation();
          if (typeof handleOTPVerification === 'function') {
            try {
              handleOTPVerification(e);
            } catch(err) {
              console.error('OTP error:', err);
              alert('OTP verification error. Please try again.');
            }
          } else {
            alert('OTP verification not available. Please refresh.');
          }
        };
      }
      
      // Resend button
      if (resendBtn) {
        resendBtn.onclick = function(e) {
          e.preventDefault();
          e.stopPropagation();
          if (typeof resendOTP === 'function') {
            try {
              resendOTP();
            } catch(err) {
              console.error('Resend error:', err);
              alert('Resend error. Please try again.');
            }
          } else {
            alert('Resend not available. Please refresh.');
          }
        };
      }
      
      // Mark as initialized
      if (loginModalOverlay) {
        loginModalOverlay.dataset.allHandlersSet = 'true';
      }
    }
    
    // Setup handlers immediately and on DOM ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', setupAllLoginHandlers);
    } else {
      setupAllLoginHandlers();
    }
    
    // Retry after short delays to ensure it works
    setTimeout(setupAllLoginHandlers, 50);
    setTimeout(setupAllLoginHandlers, 200);

    // Close on Escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && loginModalOverlay && loginModalOverlay.classList.contains('active')) {
        closeLoginModal();
      }
    });

    // Update floating button visibility
    function updateFloatingButton() {
      const floatingBtn = document.getElementById('floatingLoginBtn');
      const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
      
      if (floatingBtn) {
        if (currentUser) {
          floatingBtn.style.display = 'none';
          document.body.classList.add('logged-in');
        } else {
          floatingBtn.style.display = 'flex';
          document.body.classList.remove('logged-in');
        }
      }
    }

    // Check if user should see login modal on page load
    document.addEventListener('DOMContentLoaded', () => {
      const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
      const rememberUser = localStorage.getItem('rememberUser');
      const hasSeenLogin = sessionStorage.getItem('hasSeenLogin');
      
      // Update floating button
      updateFloatingButton();
      
      // Show login modal if:
      // 1. User is not logged in
      // 2. User hasn't chosen to remember
      // 3. User hasn't seen it in this session
      if (!currentUser && !rememberUser && !hasSeenLogin) {
        setTimeout(() => {
          openLoginModal();
        }, 500);
      }
    });


    function handleSignOut() {
      if (window.showConfirmDialog) {
        window.showConfirmDialog('Are you sure you want to sign out?', 'Sign Out').then((confirmed) => {
          if (confirmed) {
            localStorage.removeItem('currentUser');
            localStorage.removeItem('rememberUser');
            updateFloatingButton();
            if (window.updateProfileSidebar) {
              updateProfileSidebar();
            }
            if (window.closeProfileSidebar) {
              closeProfileSidebar();
            }
            if (window.showToast) {
              showToast('Signed out successfully', 'success', 'Sign Out');
            }
          }
        });
      } else {
        // Fallback to browser confirm if custom modal not available
        if (confirm('Are you sure you want to sign out?')) {
          localStorage.removeItem('currentUser');
          localStorage.removeItem('rememberUser');
          updateFloatingButton();
          if (window.updateProfileSidebar) {
            updateProfileSidebar();
          }
          if (window.closeProfileSidebar) {
            closeProfileSidebar();
          }
          if (window.showToast) {
            showToast('Signed out successfully', 'success', 'Sign Out');
          }
        }
      }
    }

    // Make functions globally available
    window.openLoginModal = openLoginModal;
    window.closeLoginModal = closeLoginModal;
    window.handlePhoneLogin = handlePhoneLogin;
    window.handleOTPVerification = handleOTPVerification;
    window.resendOTP = resendOTP;
    window.handleSignOut = handleSignOut;
    window.updateFloatingButton = updateFloatingButton;
    
    // NOW setup handlers after functions are available
    setupAllLoginHandlers();
    setTimeout(setupAllLoginHandlers, 100);

    // Attach direct event listener immediately - ultra-fast (bypasses any overrides)
    (function attachButtonListener() {
      const floatingBtn = document.getElementById('floatingLoginBtn');
      if (floatingBtn) {
        // Store modal element reference directly in closure - bypasses all function calls
        const modalId = 'loginModalOverlay';
        
        // Use capture phase for fastest response (runs before other handlers)
        floatingBtn.addEventListener('click', function openModalDirectly(e) {
          e.preventDefault();
          e.stopPropagation();
          e.stopImmediatePropagation();
          
          // Direct DOM access - no function calls, no overrides possible
          const overlay = loginModalOverlay || document.getElementById(modalId);
          if (overlay) {
            // Cache for next click
            loginModalOverlay = overlay;
            
            // Open instantly - no transitions, no delays
            overlay.style.cssText = 'display: flex !important; opacity: 1 !important; visibility: visible !important;';
            overlay.classList.add('active');
            document.body.style.overflow = 'hidden';
          }
        }, true); // Capture phase - executes first
      } else if (document.readyState === 'loading') {
        // If button not found yet, wait for DOM and try once
        document.addEventListener('DOMContentLoaded', attachButtonListener, { once: true });
      }
    })();
    
    // Also try immediately in case script runs after DOM
    const btn = document.getElementById('floatingLoginBtn');
    const modal = document.getElementById('loginModalOverlay');
    if (btn && modal) {
      loginModalOverlay = modal;
      btn.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        e.stopImmediatePropagation();
        modal.style.cssText = 'display: flex !important; opacity: 1 !important; visibility: visible !important;';
        modal.classList.add('active');
        document.body.style.overflow = 'hidden';
      }, true);
    }
  </script>
  <script>
    // ===== Search Functionality =====
    // ====== FLASH SALE COUNTDOWN ======
    function updateFlashSaleTimer() {
      const endTime = localStorage.getItem('flashSaleEndTime');
      if (!endTime) {
        const newEndTime = new Date().getTime() + (24 * 60 * 60 * 1000);
        localStorage.setItem('flashSaleEndTime', newEndTime.toString());
        updateFlashSaleTimer();
        return;
      }
      
      const now = new Date().getTime();
      const distance = parseInt(endTime) - now;
      
      if (distance < 0) {
        const newEndTime = new Date().getTime() + (24 * 60 * 60 * 1000);
        localStorage.setItem('flashSaleEndTime', newEndTime.toString());
        updateFlashSaleTimer();
        return;
      }
      
      const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((distance % (1000 * 60)) / 1000);
      
      const hoursEl = document.getElementById('hours');
      const minutesEl = document.getElementById('minutes');
      const secondsEl = document.getElementById('seconds');
      
      if (hoursEl) hoursEl.textContent = String(hours).padStart(2, '0');
      if (minutesEl) minutesEl.textContent = String(minutes).padStart(2, '0');
      if (secondsEl) secondsEl.textContent = String(seconds).padStart(2, '0');
    }
    
    setInterval(updateFlashSaleTimer, 1000);
    updateFlashSaleTimer();

    // ====== NEWSLETTER SUBSCRIPTION ======
    function subscribeNewsletter() {
      const email = document.getElementById('newsletterEmail')?.value.trim();
      if (!email) {
        if (window.showToast) {
          showToast('Please enter your email', 'error', 'Email Required');
        }
        return;
      }
      
      let subscriptions = JSON.parse(localStorage.getItem('newsletterSubscriptions') || '[]');
      if (subscriptions.includes(email)) {
        if (window.showToast) {
          showToast('You are already subscribed!', 'info', 'Already Subscribed');
        }
        return;
      }
      
      subscriptions.push(email);
      localStorage.setItem('newsletterSubscriptions', JSON.stringify(subscriptions));
      const emailInput = document.getElementById('newsletterEmail');
      if (emailInput) emailInput.value = '';
      
      if (window.showToast) {
        showToast('Successfully subscribed to newsletter!', 'success', 'Subscribed');
      } else {
        alert('Successfully subscribed to newsletter!');
      }
    }
    
    window.subscribeNewsletter = subscribeNewsletter;

    const searchBtn = document.getElementById('searchBtn');
    const searchModal = document.getElementById('searchModal');
    const searchInput = document.getElementById('searchInput');
    const searchClose = document.getElementById('searchClose');
    const searchResults = document.getElementById('searchResults');

    // Complete product list for search
    const allProducts = [
      { name: 'Colourblocked Polo T-shirt', price: 593, originalPrice: 1099, brand: 'Allen Solly', image: 'assets/all_products/q1.jpg' },
      { name: 'Pure Cotton Custom Fit Shirt', price: 917, originalPrice: 1799, brand: 'Allen Solly', image: 'assets/all_products/q3.jpg' },
      { name: 'Polo Collar Slim Fit T-shirt', price: 929, originalPrice: 1499, brand: 'Louis Philippe Jeans', image: 'assets/all_products/q4.jpg' },
      { name: 'Pure Cotton Casual Shirt', price: 993, originalPrice: 1949, brand: 'Allen Solly', image: 'assets/all_products/q5.jpg' },
      { name: 'Classic Fit Formal Shirt', price: 849, originalPrice: 1599, brand: 'Louis Philippe Jeans', image: 'assets/all_products/q1.jpg' },
      { name: 'Regular Fit Cotton T-shirt', price: 699, originalPrice: 1299, brand: 'Allen Solly', image: 'assets/all_products/q4.jpg' },
      { name: 'Slim Fit Cotton Shirt', price: 799, originalPrice: 1499, brand: 'Louis Philippe Jeans', image: 'assets/all_products/q3.jpg' },
      { name: 'Oversized Graphic Tee', price: 499, originalPrice: 1099, brand: 'V Store', image: 'assets/genz/ts.webp' },
      { name: 'Minimalist Hoodie', price: 799, originalPrice: 1499, brand: 'V Store', image: 'assets/genz/hd.webp' },
      { name: 'Baggy Fit Jeans', price: 999, originalPrice: 1799, brand: 'V Store', image: 'assets/genz/Bg.jpg' },
      { name: 'Co-ord Set', price: 1199, originalPrice: 1999, brand: 'V Store', image: 'assets/genz/cd.webp' },
      // Additional products from other categories
      { name: 'Men\'s Pure Cotton T-Shirt', price: 476, originalPrice: 1499, brand: 'V Store', image: 'assets/products/p1.jpg' },
      { name: 'Men\'s Casual T-Shirt', price: 471, originalPrice: 1099, brand: 'V Store', image: 'assets/products/p2.jpg' },
      { name: 'Men\'s Formal Shirt', price: 699, originalPrice: 1299, brand: 'V Store', image: 'assets/products/p3.jpg' },
      { name: 'Men\'s Polo T-Shirt', price: 479, originalPrice: 999, brand: 'V Store', image: 'assets/products/p4.jpg' },
      { name: 'Men\'s Cotton Shirt', price: 619, originalPrice: 1199, brand: 'V Store', image: 'assets/products/p5.jpg' },
      { name: 'Men\'s Printed T-Shirt', price: 404, originalPrice: 899, brand: 'V Store', image: 'assets/products/p6.jpg' }
    ];

    function performSearch(query) {
      const lowerQuery = query.toLowerCase().trim();
      if (lowerQuery === '') {
        searchResults.innerHTML = '';
        return;
      }

      const filtered = allProducts.filter(p => 
        p.name.toLowerCase().includes(lowerQuery) ||
        p.brand.toLowerCase().includes(lowerQuery) ||
        (p.name.toLowerCase().split(' ').some(word => word.startsWith(lowerQuery)))
      );

      searchResults.innerHTML = '';
      
      if (filtered.length === 0) {
        searchResults.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-color, #666);">No products found</div>';
        return;
      }

      // Limit to 10 results for better UX
      const displayResults = filtered.slice(0, 10);

      displayResults.forEach(product => {
        const item = document.createElement('div');
        item.style.cssText = 'padding: 12px; border-bottom: 1px solid rgba(0,0,0,0.1); cursor: pointer; transition: background-color 0.2s; display: flex; align-items: center; gap: 12px;';
        
        // Create product detail URL
        const productUrl = `pages/product-detail.html?name=${encodeURIComponent(product.name)}&price=${product.price}&originalPrice=${product.originalPrice || product.price}&image=${encodeURIComponent(product.image)}&brand=${encodeURIComponent(product.brand)}`;
        
        item.innerHTML = `
          <img src="${product.image}" alt="${product.name}" style="width: 60px; height: 60px; object-fit: cover; border-radius: 6px; flex-shrink: 0;" onerror="this.src='assets/products/p1.jpg'">
          <div style="flex: 1; min-width: 0;">
            <h4 style="margin: 0 0 4px 0; color: var(--text-color, #333); font-size: 1rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${product.name}</h4>
            <p style="margin: 0; color: #e53935; font-weight: 600; font-size: 0.9rem;">₹${product.price}</p>
            ${product.originalPrice && product.originalPrice > product.price ? `<p style="margin: 2px 0 0 0; color: var(--text-color, #999); font-size: 0.8rem; text-decoration: line-through;">₹${product.originalPrice}</p>` : ''}
            <p style="margin: 4px 0 0 0; color: var(--text-color, #666); font-size: 0.85rem;">${product.brand}</p>
          </div>
        `;
        item.addEventListener('mouseenter', () => {
          item.style.background = 'var(--muted-white, #f5f5f5)';
        });
        item.addEventListener('mouseleave', () => {
          item.style.background = 'transparent';
        });
        item.addEventListener('click', () => {
          window.location.href = productUrl;
          searchModal.style.display = 'none';
          searchInput.value = '';
          searchResults.innerHTML = '';
        });
        searchResults.appendChild(item);
      });
      
      // Show "View All Results" if more than 10
      if (filtered.length > 10) {
        const viewAll = document.createElement('div');
        viewAll.style.cssText = 'padding: 12px; text-align: center; border-top: 1px solid rgba(0,0,0,0.1); cursor: pointer; font-weight: 600; color: #ff6d2e;';
        viewAll.textContent = `View all ${filtered.length} results →`;
        viewAll.addEventListener('click', () => {
          window.location.href = `pages/products.html?search=${encodeURIComponent(query)}`;
          searchModal.style.display = 'none';
        });
        searchResults.appendChild(viewAll);
      }
    }

    if (searchBtn) {
      searchBtn.addEventListener('click', () => {
        searchModal.style.display = 'flex';
        setTimeout(() => searchInput.focus(), 100);
      });
    }

    if (searchClose) {
      searchClose.addEventListener('click', () => {
        searchModal.style.display = 'none';
        searchInput.value = '';
        searchResults.innerHTML = '';
      });
    }

    if (searchModal) {
      searchModal.addEventListener('click', (e) => {
        if (e.target === searchModal) {
          searchModal.style.display = 'none';
          searchInput.value = '';
          searchResults.innerHTML = '';
        }
      });
    }

    // ====== ENHANCED SEARCH WITH AUTOCOMPLETE ======
    function getSearchHistory() {
      return JSON.parse(localStorage.getItem('searchHistory') || '[]');
    }

    function saveSearchHistory(query) {
      if (!query.trim()) return;
      let history = getSearchHistory();
      history = history.filter(h => h.toLowerCase() !== query.toLowerCase());
      history.unshift(query);
      history = history.slice(0, 5); // Keep last 5 searches
      localStorage.setItem('searchHistory', JSON.stringify(history));
    }

    function showAutocomplete(query) {
      const autocomplete = document.getElementById('searchAutocomplete');
      if (!autocomplete) return;
      
      const lowerQuery = query.toLowerCase().trim();
      
      if (lowerQuery === '') {
        // Show recent searches
        const history = getSearchHistory();
        if (history.length > 0) {
          autocomplete.classList.add('active');
          autocomplete.innerHTML = `
            <div class="autocomplete-section">
              <div class="autocomplete-section-title">Recent Searches</div>
              ${history.map(term => `
                <div class="autocomplete-recent" onclick="document.getElementById('searchInput').value='${term}'; performSearch('${term}');">
                  <svg class="autocomplete-recent-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="M21 21l-4.35-4.35"></path>
                  </svg>
                  <span class="autocomplete-recent-text">${term}</span>
                </div>
              `).join('')}
              <div style="padding: 8px 16px; text-align: right;">
                <button class="autocomplete-clear" onclick="clearSearchHistory()">Clear History</button>
              </div>
            </div>
          `;
        } else {
          autocomplete.classList.remove('active');
        }
        return;
      }
      
      // Show suggestions
      const suggestions = allProducts.filter(p => 
        p.name.toLowerCase().includes(lowerQuery) ||
        p.brand.toLowerCase().includes(lowerQuery) ||
        (p.name.toLowerCase().split(' ').some(word => word.startsWith(lowerQuery)))
      ).slice(0, 5);
      
      if (suggestions.length > 0) {
        autocomplete.classList.add('active');
        autocomplete.innerHTML = `
          <div class="autocomplete-section">
            <div class="autocomplete-section-title">Suggestions</div>
            ${suggestions.map(product => {
              const productUrl = `pages/product-detail.html?name=${encodeURIComponent(product.name)}&price=${product.price}&originalPrice=${product.originalPrice || product.price}&image=${encodeURIComponent(product.image)}&brand=${encodeURIComponent(product.brand)}`;
              return `
                <div class="autocomplete-item" onclick="window.location.href='${productUrl}'; document.getElementById('searchModal').style.display='none';">
                  <img src="${product.image}" alt="${product.name}" class="autocomplete-item-image" onerror="this.src='assets/products/p1.jpg'">
                  <div class="autocomplete-item-info">
                    <div class="autocomplete-item-name">${product.name}</div>
                    <div class="autocomplete-item-price">₹${product.price}</div>
                  </div>
                </div>
              `;
            }).join('')}
          </div>
        `;
      } else {
        autocomplete.classList.remove('active');
      }
    }

    function selectSearchSuggestion(term) {
      const searchInput = document.getElementById('searchInput');
      if (searchInput) {
        searchInput.value = term;
        performSearch(term);
        saveSearchHistory(term);
      }
      const autocomplete = document.getElementById('searchAutocomplete');
      if (autocomplete) autocomplete.classList.remove('active');
    }

    function clearSearchHistory() {
      localStorage.removeItem('searchHistory');
      const autocomplete = document.getElementById('searchAutocomplete');
      if (autocomplete) autocomplete.classList.remove('active');
      if (window.showToast) {
        showToast('Search history cleared', 'info', 'Search');
      }
    }

    window.selectSearchSuggestion = selectSearchSuggestion;
    window.clearSearchHistory = clearSearchHistory;

    if (searchInput) {
      searchInput.addEventListener('input', (e) => {
        const query = e.target.value;
        showAutocomplete(query);
        if (query.length >= 2) {
          performSearch(query);
        } else {
          searchResults.innerHTML = '';
        }
      });

      searchInput.addEventListener('focus', () => {
        showAutocomplete(searchInput.value);
      });

      searchInput.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          searchModal.style.display = 'none';
          searchInput.value = '';
          searchResults.innerHTML = '';
          const autocomplete = document.getElementById('searchAutocomplete');
          if (autocomplete) autocomplete.classList.remove('active');
        }
        if (e.key === 'Enter') {
          const query = searchInput.value.trim();
          if (query) {
            saveSearchHistory(query);
            performSearch(query);
            // If more than 10 results, redirect to products page
            const filtered = allProducts.filter(p => 
              p.name.toLowerCase().includes(query.toLowerCase()) ||
              p.brand.toLowerCase().includes(query.toLowerCase()) ||
              (p.name.toLowerCase().split(' ').some(word => word.startsWith(query.toLowerCase())))
            );
            if (filtered.length > 10) {
              window.location.href = `pages/products.html?search=${encodeURIComponent(query)}`;
            }
          }
        }
      });
    }

    // Close autocomplete when clicking outside
    document.addEventListener('click', (e) => {
      const autocomplete = document.getElementById('searchAutocomplete');
      if (autocomplete && !autocomplete.contains(e.target) && e.target !== searchInput) {
        autocomplete.classList.remove('active');
      }
    });

    // ===== Mobile Menu Toggle =====
    const mobileMenuBtn = document.getElementById("mobileMenuBtn");
    const mobileNav = document.getElementById("mobileNav");
    if (mobileMenuBtn && mobileNav) {
      mobileMenuBtn.addEventListener("click", () => {
        mobileNav.classList.toggle("active");
      });
      document.addEventListener("click", (e) => {
        if (!mobileMenuBtn.contains(e.target) && !mobileNav.contains(e.target)) {
          mobileNav.classList.remove("active");
        }
      });
      mobileNav.querySelectorAll(".nav-item").forEach(item => {
        item.addEventListener("click", () => {
          mobileNav.classList.remove("active");
        });
      });
    }

    // ===== Dark Mode Toggle - Update Sidebar Text =====
    // Update Light Mode text based on current theme (optimized)
    function updateLightModeText() {
      const sidebarLightModeText = document.getElementById('sidebarLightModeText');
      if (sidebarLightModeText) {
        const isDarkMode = document.body.classList.contains('dark-mode');
        sidebarLightModeText.textContent = isDarkMode ? 'Light Mode' : 'Dark Mode';
      }
    }

    // Update on theme change (wait for app.js to initialize first)
    function setupLightModeTextUpdate() {
      const darkModeSwitch = document.getElementById('dark-mode-switch');
      if (!darkModeSwitch) {
        setTimeout(setupLightModeTextUpdate, 100);
        return;
      }
      
      // Listen for theme changes
      darkModeSwitch.addEventListener('change', function() {
        requestAnimationFrame(updateLightModeText);
      });
      updateLightModeText();
    }
    
    // Setup sidebar light mode toggle button
    const sidebarLightModeBtn = document.getElementById('sidebarLightMode');
    if (sidebarLightModeBtn) {
      sidebarLightModeBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        const darkModeSwitch = document.getElementById('dark-mode-switch');
        if (darkModeSwitch) {
          darkModeSwitch.checked = !darkModeSwitch.checked;
          // Create and dispatch change event to trigger theme toggle
          const changeEvent = new Event('change', { bubbles: true });
          darkModeSwitch.dispatchEvent(changeEvent);
        }
      });
    }
    
    // Initialize after DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => {
        setTimeout(setupLightModeTextUpdate, 200);
      });
    } else {
      setTimeout(setupLightModeTextUpdate, 200);
    }

    // ====== STORE-BASED HOMEPAGE LOADING ======
    // This implements the customer flow: ?store=slug → Load store data and products
    
    // Get store slug from URL parameter
    function getStoreSlug() {
      const params = new URLSearchParams(window.location.search);
      return params.get('store');
    }

    // Store current store slug globally
    window.currentStoreSlug = getStoreSlug();

    // Load store data and products when homepage loads with ?store=slug
    async function loadStoreHomepage() {
      const storeSlug = getStoreSlug();
      if (!storeSlug) {
        // No store parameter - show default homepage
        return;
      }

      const storeInfoSection = document.getElementById('store-info-section');
      const storeNameDisplay = document.getElementById('store-name-display');
      const storeDescDisplay = document.getElementById('store-description-display');
      const storeLogoImg = document.getElementById('store-logo-img');
      const storeCategories = document.getElementById('store-categories');
      const productsTitle = document.getElementById('products-title');
      const carouselTrack = document.getElementById('carouselTrack');

      if (!storeInfoSection) return;

      try {
        // 1. Load store info
        let store = null;
        if (window.API && window.API.getStoreBySlug) {
          try {
            store = await window.API.getStoreBySlug(storeSlug);
          } catch (e) {
            console.error('Failed to load store:', e);
          }
        }

        if (store) {
          // Show store info section
          storeInfoSection.style.display = 'block';
          
          // Display store name
          if (storeNameDisplay) {
            storeNameDisplay.textContent = store.storeName || store.name || store.shopName || 'Store';
          }

          // Display store description
          if (storeDescDisplay) {
            const desc = store.businessDetails?.businessDescription || store.description || '';
            storeDescDisplay.textContent = desc;
            storeDescDisplay.style.display = desc ? 'block' : 'none';
          }

          // Display store logo
          if (storeLogoImg) {
            const logo = store.logoUrl || store.logo || '';
            if (logo) {
              storeLogoImg.src = logo;
              storeLogoImg.style.display = 'block';
            }
          }

          // Update page title
          document.title = `${store.storeName || store.name || 'Store'} - SmartBiz`;
        }

        // 2. Load store products
        let products = [];
        if (window.API && window.API.getStoreProductsBySlug) {
          try {
            products = await window.API.getStoreProductsBySlug(storeSlug);
          } catch (e) {
            console.error('Failed to load products:', e);
          }
        }

        // 3. Display products in carousel
        if (products.length > 0 && carouselTrack) {
          // Update title
          if (productsTitle) {
            productsTitle.textContent = store ? `${store.storeName || 'Store'} Products` : 'Products';
          }

          // Clear existing items
          carouselTrack.innerHTML = '';

          // Add products to carousel
          products.slice(0, 12).forEach(product => {
            const productName = product.productName || product.name || 'Product';
            const productPrice = product.sellingPrice || product.price || 0;
            const productImage = product.productImages?.[0] || product.image || product.imageUrl || 'assets/products/p1.jpg';
            const productId = product.productId || product.id;
            const originalPrice = product.originalPrice || product.mrp || productPrice;
            
            // Build product URL with store context
            const productUrl = `pages/product-detail.html?id=${productId}&store=${encodeURIComponent(storeSlug)}`;
            
            const carouselItem = document.createElement('div');
            carouselItem.className = 'carousel-item';
            carouselItem.onclick = () => window.location.href = productUrl;
            carouselItem.innerHTML = `
              <img src="${productImage}" alt="${productName}" onerror="this.src='assets/products/p1.jpg'">
              <h3>${productName}</h3>
              <p style="color: var(--primary-color, #007bff); font-weight: 600;">₹${productPrice}</p>
            `;
            carouselTrack.appendChild(carouselItem);
          });

          // Reinitialize carousel if needed
          if (window.initCarousel) {
            window.initCarousel();
          }
        }

        // 4. Load and display categories - Store-specific
        if (storeCategories && window.API) {
          try {
            let categories = [];
            
            // Use store-specific categories endpoint if available
            if (storeSlug && window.API.getStoreCategoriesBySlug) {
              categories = await window.API.getStoreCategoriesBySlug(storeSlug);
            } else if (window.API.getAllCategories) {
              // Fallback to all categories (for backward compatibility)
              categories = await window.API.getAllCategories();
            }
            
            const storeCategoriesList = Array.isArray(categories) ? categories : [];
            
            if (storeCategoriesList.length > 0) {
              storeCategories.innerHTML = '';
              storeCategoriesList.slice(0, 8).forEach(category => {
                const categoryName = category.categoryName || category.name || 'Category';
                const categoryUrl = `pages/categories.html?store=${encodeURIComponent(storeSlug)}`;
                
                const categoryCard = document.createElement('a');
                categoryCard.href = categoryUrl;
                categoryCard.className = 'category-card';
                categoryCard.innerHTML = `
                  <img src="${category.categoryImage || category.image || 'assets/products/cs.jpg'}" alt="${categoryName}" onerror="this.src='assets/products/cs.jpg'">
                  <p>${categoryName}</p>
                `;
                storeCategories.appendChild(categoryCard);
              });
            }
          } catch (e) {
            console.error('Failed to load categories:', e);
          }
        }

      } catch (error) {
        console.error('Error loading store homepage:', error);
        if (storeInfoSection) {
          storeInfoSection.innerHTML = `<div class="container" style="text-align: center; padding: 40px; color: var(--text-muted, #666);">
            <p>Failed to load store data. Please try again later.</p>
          </div>`;
        }
      }
    }

    // Initialize store homepage on load
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', loadStoreHomepage);
    } else {
      loadStoreHomepage();
    }

    // Helper function to add store parameter to URLs
    function addStoreToUrl(url) {
      const storeSlug = getStoreSlug();
      if (!storeSlug) return url;
      
      try {
        const urlObj = new URL(url, window.location.origin);
        urlObj.searchParams.set('store', storeSlug);
        return urlObj.pathname + urlObj.search;
      } catch (e) {
        // If URL parsing fails, append manually
        const separator = url.includes('?') ? '&' : '?';
        return url + separator + 'store=' + encodeURIComponent(storeSlug);
      }
    }

    // Make addStoreToUrl available globally
    window.addStoreToUrl = addStoreToUrl;


  </script>
</body>
</html>

